<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Dev Tools - Interview-Driven, Research-First API Development</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    /* ============================================
       90s STYLE - LIGHT THEME WITH RED ACCENTS
       Boxy, minimal, system fonts
       ============================================ */

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Light theme base */
      --bg: #ffffff;
      --bg-secondary: #f8f8f8;
      --bg-tertiary: #f0f0f0;
      --text: #000000;
      --text-muted: #666666;
      --text-light: #888888;
      --border: #000000;
      --border-light: #cccccc;

      /* Red accents (Hustle Together branding) */
      --accent: #BA0C2F;
      --accent-light: rgba(186, 12, 47, 0.1);
      --accent-glow: rgba(186, 12, 47, 0.3);

      /* Status colors */
      --success: #22c55e;
      --warning: #eab308;
      --error: #ef4444;

      /* 90s style greys */
      --grey-dark: #222222;
      --grey-mid: #888888;
      --grey-light: #dddddd;
    }

    /* Dark theme (toggle later) */
    [data-theme="dark"] {
      --bg: #0a0a0a;
      --bg-secondary: #111111;
      --bg-tertiary: #1a1a1a;
      --text: #f0f0f0;
      --text-muted: #999999;
      --text-light: #666666;
      --border: #333333;
      --border-light: #444444;
      --grey-light: #333333;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', system-ui, sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* ============================================
       BACKGROUND GRID & FLOATING SHAPES
       ============================================ */
    .background-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      background-image:
        linear-gradient(var(--grey-light) 1px, transparent 1px),
        linear-gradient(90deg, var(--grey-light) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.5;
    }

    .floating-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      overflow: hidden;
    }

    .floating-shape {
      position: absolute;
      opacity: 0.15;
    }

    .floating-shape.square {
      width: 20px;
      height: 20px;
      border: 1px solid var(--border);
    }

    .floating-shape.square-filled {
      width: 12px;
      height: 12px;
      background: var(--border);
    }

    .floating-shape.line-h {
      width: 40px;
      height: 1px;
      background: var(--border);
    }

    .floating-shape.line-v {
      width: 1px;
      height: 40px;
      background: var(--border);
    }

    .floating-shape.plus {
      width: 20px;
      height: 20px;
      position: relative;
    }

    .floating-shape.plus::before,
    .floating-shape.plus::after {
      content: '';
      position: absolute;
      background: var(--border);
    }

    .floating-shape.plus::before {
      width: 20px;
      height: 2px;
      top: 9px;
      left: 0;
    }

    .floating-shape.plus::after {
      width: 2px;
      height: 20px;
      left: 9px;
      top: 0;
    }

    .floating-shape.circle {
      width: 16px;
      height: 16px;
      border: 1px solid var(--border);
      border-radius: 50%;
    }

    .floating-shape.dot {
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.3;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }

    @keyframes float-reverse {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(20px) rotate(-5deg); }
    }

    @keyframes drift {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(15px); }
    }

    /* ============================================
       NAVIGATION
       ============================================ */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 40px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }

    .nav-brand {
      text-decoration: none;
    }

    .hustle-brand {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: -0.02em;
    }

    .nav-brand:hover .hustle-brand {
      color: var(--grey-dark);
    }

    .nav-links {
      display: flex;
      gap: 8px;
    }

    .nav-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 16px;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .nav-btn:hover {
      background: var(--text);
      color: var(--bg);
    }

    .nav-btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .nav-btn.primary:hover {
      background: transparent;
      color: var(--accent);
    }

    /* ============================================
       SECTIONS - FULL VIEWPORT SLIDES
       ============================================ */
    section {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 120px 40px 80px;
      position: relative;
      border-bottom: 1px solid var(--border-light);
    }

    section:last-of-type {
      border-bottom: none;
    }

    .section-inner {
      max-width: 1200px;
      width: 100%;
    }

    /* ============================================
       TYPOGRAPHY
       ============================================ */
    h1 {
      font-size: 4.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.1;
    }

    h2 {
      font-size: 2.5rem;
      font-weight: 600;
      margin-bottom: 30px;
    }

    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .mono {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
    }

    .text-muted {
      color: var(--text-muted);
    }

    .text-accent {
      color: var(--accent);
    }

    /* ============================================
       SECTION 1: HERO
       ============================================ */
    #hero {
      text-align: center;
    }

    .hero-badge {
      display: inline-block;
      border: 1px solid var(--border);
      padding: 8px 16px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      margin-bottom: 30px;
      opacity: 0;
      transform: translateY(20px);
    }

    .hero-title {
      opacity: 0;
      transform: translateY(30px);
    }

    .hero-title .package-name {
      display: block;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1.75rem;
      color: var(--text-muted);
      margin-top: 15px;
      font-weight: 400;
    }

    .hero-tagline {
      font-size: 1.4rem;
      color: var(--text-muted);
      margin: 40px 0 50px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      opacity: 0;
      line-height: 1.5;
    }

    .hero-terminal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 40px 50px;
      max-width: 700px;
      margin: 0 auto 50px;
      text-align: left;
      opacity: 0;
      transform: translateY(20px);
    }

    .hero-terminal .terminal-header {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-light);
    }

    .hero-terminal .terminal-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid var(--border);
    }

    .hero-terminal .terminal-dot.red { background: var(--error); border-color: var(--error); }
    .hero-terminal .terminal-dot.yellow { background: var(--warning); border-color: var(--warning); }
    .hero-terminal .terminal-dot.green { background: var(--success); border-color: var(--success); }

    .hero-terminal pre {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1rem;
      line-height: 1.6;
    }

    .hero-terminal .prompt {
      color: var(--text-muted);
    }

    .hero-terminal .command {
      color: var(--accent);
    }

    .cursor-blink {
      display: inline-block;
      width: 10px;
      height: 20px;
      background: var(--accent);
      animation: blink 1s infinite;
      vertical-align: middle;
      margin-left: 2px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .hero-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      opacity: 0;
      transform: translateY(20px);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9rem;
      text-decoration: none;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 4px 4px 0 var(--border);
    }

    .btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .btn.primary:hover {
      box-shadow: 4px 4px 0 var(--accent-glow);
    }

    .scroll-indicator {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--text-muted);
      font-size: 0.8rem;
      font-family: 'SF Mono', 'Monaco', monospace;
      animation: bounce 2s infinite;
      opacity: 0;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(10px); }
    }

    /* Section headers - shared styles */
    .section-header {
      text-align: center;
      margin-bottom: 80px;
    }

    .section-header p {
      margin-top: 15px;
    }

    /* ============================================
       SECTION 2: THE PROBLEM
       ============================================ */

    .problem-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      max-width: 1200px;
    }

    .problem-card {
      border: 1px solid var(--border);
      padding: 35px 30px;
      background: var(--bg);
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.2s ease;
    }

    .problem-card:hover {
      transform: translateY(-4px);
      box-shadow: 4px 4px 0 var(--border);
    }

    .problem-card .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .problem-card .icon {
      width: 48px;
      height: 48px;
      border: 1px solid var(--accent);
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .problem-card .card-header h3 {
      margin: 0;
      font-size: 1.1rem;
      line-height: 1.3;
    }

    .problem-card .issue-label,
    .problem-card .why-label {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--accent);
      margin-bottom: 6px;
      display: block;
    }

    .problem-card .issue-text {
      color: var(--text);
      font-size: 0.95rem;
      line-height: 1.5;
      margin-bottom: 18px;
    }

    .problem-card .why-text {
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.5;
      padding-left: 12px;
      border-left: 2px solid var(--border-light);
    }

    /* ============================================
       SECTION 3: THE SOLUTION
       ============================================ */
    #solution .section-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .solution-stats {
      display: flex;
      justify-content: center;
      gap: 60px;
      margin-bottom: 60px;
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
      opacity: 0;
      transform: translateY(20px);
    }

    .stat .number {
      font-size: 4rem;
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }

    .stat .label {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 10px;
    }

    .solution-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      max-width: 1200px;
    }

    .solution-card {
      border: 1px solid var(--border);
      padding: 30px 25px;
      background: var(--bg);
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.2s ease;
    }

    .solution-card:hover {
      border-color: var(--accent);
      transform: translateY(-4px);
      box-shadow: 4px 4px 0 var(--border);
    }

    .solution-card .solves-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      background: var(--bg-subtle);
      padding: 4px 10px;
      border: 1px solid var(--border-light);
      margin-bottom: 15px;
    }

    .solution-card .solves-badge i {
      color: var(--accent);
    }

    .solution-card h3 {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 1.05rem;
    }

    .solution-card h3 i {
      color: var(--accent);
      font-size: 1.1rem;
    }

    .solution-card .description {
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .solution-card .hook-name {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      color: var(--accent);
      background: rgba(186, 12, 47, 0.08);
      padding: 6px 10px;
      border-left: 2px solid var(--accent);
    }

    /* Keep old .pillar and .solution-pillars for backwards compat but hide */
    .solution-pillars {
      display: none;
    }

    .pillar {
      display: none;
    }

    /* ============================================
       SECTION 4: RESEARCH GROUNDING
       ============================================ */
    #grounding .section-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .grounding-tools {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .grounding-tool {
      border: 1px solid var(--border);
      padding: 30px;
      opacity: 0;
      transform: translateY(20px);
    }

    .tool-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
    }

    .tool-header i {
      font-size: 1.5rem;
      color: var(--accent);
    }

    .tool-header h3 {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1rem;
      color: var(--text);
      margin: 0;
    }

    .tool-description {
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .tool-example {
      background: var(--grey-dark);
      padding: 15px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      color: #f0f0f0;
      margin-bottom: 15px;
    }

    .tool-example code {
      color: var(--accent);
      background: none;
      padding: 0;
    }

    .tool-why {
      font-size: 0.85rem;
      color: var(--text);
      background: rgba(186, 12, 47, 0.05);
      padding: 12px 15px;
      border-left: 3px solid var(--accent);
      margin: 0;
    }

    .grounding-enforcement {
      border: 2px solid var(--accent);
      padding: 25px 30px;
      background: var(--accent-light);
      text-align: center;
      opacity: 0;
      transform: translateY(20px);
    }

    .grounding-enforcement h4 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: var(--accent);
      margin-bottom: 10px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.95rem;
    }

    .grounding-enforcement p {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin: 0;
    }

    /* ============================================
       SECTION 5: HOOK SYSTEM
       ============================================ */
    #hooks .section-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .problem-solution-intro {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 30px;
      align-items: center;
      margin-bottom: 60px;
      padding: 40px;
      background: linear-gradient(135deg, rgba(186, 12, 47, 0.03) 0%, rgba(186, 12, 47, 0.01) 100%);
      border: 1px solid var(--border);
    }

    .ps-problem, .ps-solution {
      padding: 25px;
    }

    .ps-problem h3, .ps-solution h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .ps-problem h3 {
      color: var(--text);
    }

    .ps-solution h3 {
      color: var(--accent);
    }

    .ps-problem p, .ps-solution p {
      color: var(--text-muted);
      line-height: 1.6;
    }

    .ps-arrow {
      font-size: 2rem;
      color: var(--accent);
    }

    .hook-types {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin-bottom: 60px;
    }

    .hook-type {
      border: 1px solid var(--border);
      padding: 30px;
      opacity: 0;
      transform: translateY(20px);
    }

    .hook-type h3 {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1rem;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .hook-type p {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .hook-type .count {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      color: var(--text-light);
    }

    .exit-code-demo {
      border: 2px solid var(--accent);
      padding: 40px;
      background: var(--accent-light);
      opacity: 0;
      transform: translateY(20px);
    }

    .exit-code-demo h3 {
      color: var(--accent);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .exit-code-demo .badge {
      background: var(--accent);
      color: #fff;
      padding: 4px 10px;
      font-size: 0.75rem;
      font-family: 'SF Mono', 'Monaco', monospace;
    }

    .exit-code-terminal {
      background: var(--grey-dark);
      color: #f0f0f0;
      padding: 25px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      line-height: 1.8;
      overflow-x: auto;
    }

    .exit-code-terminal .error {
      color: #ef4444;
    }

    .exit-code-terminal .warning {
      color: #eab308;
    }

    .exit-code-terminal .success {
      color: #22c55e;
    }

    .exit-code-terminal .dim {
      opacity: 0.6;
    }

    /* Exit Code 2 Callout */
    .exit-code-callout {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 30px;
      border: 2px solid var(--accent);
      padding: 35px 40px;
      background: linear-gradient(135deg, rgba(186, 12, 47, 0.05) 0%, rgba(186, 12, 47, 0.02) 100%);
      margin-bottom: 50px;
      opacity: 0;
      transform: translateY(20px);
    }

    .callout-icon {
      font-size: 3rem;
      color: var(--accent);
      display: flex;
      align-items: flex-start;
      padding-top: 5px;
    }

    .callout-content h3 {
      color: var(--accent);
      margin-bottom: 12px;
      font-size: 1.3rem;
    }

    .callout-content > p {
      color: var(--text-muted);
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .callout-content code {
      background: rgba(186, 12, 47, 0.1);
      color: var(--accent);
      padding: 2px 8px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9em;
    }

    .callout-comparison {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .comparison-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 15px;
      border: 1px solid var(--border);
      background: #fff;
    }

    .comparison-item.highlight {
      border-color: var(--accent);
      background: rgba(186, 12, 47, 0.08);
    }

    .comparison-label {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-light);
      white-space: nowrap;
    }

    .comparison-item.highlight .comparison-label {
      color: var(--accent);
    }

    .comparison-text {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .comparison-item.highlight .comparison-text {
      color: var(--text);
      font-weight: 500;
    }

    /* ============================================
       SECTION 5: THE 12 PHASES
       ============================================ */
    #phases .section-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .phases-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .phase-card {
      border: 1px solid var(--border);
      background: var(--bg);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.2s ease;
    }

    .phase-card:hover {
      box-shadow: 4px 4px 0 var(--border);
    }

    .phase-card-main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      min-height: 180px;
    }

    .phase-info {
      padding: 25px;
      border-right: 1px solid var(--border-light);
    }

    .phase-number {
      display: inline-block;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      color: var(--accent);
      margin-bottom: 10px;
    }

    .phase-info h4 {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .phase-info p {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 15px;
    }

    .phase-hook {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      color: var(--text-light);
      padding: 4px 8px;
      border: 1px solid var(--border-light);
      background: var(--bg-secondary);
    }

    .phase-terminal {
      background: var(--grey-dark);
      color: #f0f0f0;
      padding: 20px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      line-height: 1.6;
      display: flex;
      flex-direction: column;
    }

    .phase-terminal .terminal-title {
      color: #888;
      font-size: 0.7rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #444;
    }

    .phase-terminal pre {
      flex: 1;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .phase-terminal .prompt { color: #888; }
    .phase-terminal .cmd { color: #fff; }
    .phase-terminal .output { color: #aaa; }
    .phase-terminal .highlight { color: #BA0C2F; }
    .phase-terminal .success { color: #22c55e; }
    .phase-terminal .warning { color: #eab308; }

    .expand-btn {
      width: 100%;
      padding: 12px;
      background: var(--bg-secondary);
      border: none;
      border-top: 1px solid var(--border-light);
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .expand-btn:hover {
      background: var(--accent-light);
      color: var(--accent);
    }

    .expand-btn .arrow {
      transition: transform 0.2s ease;
    }

    .expand-btn.expanded .arrow {
      transform: rotate(180deg);
    }

    .phase-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: var(--bg-secondary);
    }

    .phase-details.expanded {
      max-height: 500px;
    }

    .phase-details-inner {
      padding: 25px;
      border-top: 1px solid var(--border-light);
    }

    .phase-details h5 {
      font-size: 0.85rem;
      color: var(--accent);
      margin-bottom: 10px;
      font-family: 'SF Mono', 'Monaco', monospace;
    }

    .phase-details ul {
      list-style: none;
      margin-bottom: 20px;
    }

    .phase-details li {
      font-size: 0.85rem;
      color: var(--text-muted);
      padding: 5px 0;
      padding-left: 15px;
      position: relative;
    }

    .phase-details li::before {
      content: '>';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-family: 'SF Mono', 'Monaco', monospace;
    }

    .phase-details .state-fields {
      background: var(--bg-tertiary);
      padding: 15px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
    }

    .phase-details .state-fields code {
      color: var(--accent);
    }

    /* ============================================
       SECTION 6: TERMINAL SIMULATION
       ============================================ */
    #demo .section-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .demo-controls-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      padding: 15px 20px;
      background: var(--bg-subtle);
      border: 1px solid var(--border);
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .demo-controls-bar .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }

    .demo-controls-bar .control-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .demo-controls-bar .control-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .demo-controls-bar .control-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .demo-controls-bar .control-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .demo-controls-bar .control-btn.pulse-hint {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      animation: pulse-hint 1.5s ease-in-out infinite;
    }

    @keyframes pulse-hint {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(186, 12, 47, 0.4);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 15px 5px rgba(186, 12, 47, 0.3);
      }
    }

    .demo-prompt-message {
      position: absolute;
      top: -35px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
      animation: bounce-down 1s ease-in-out infinite;
      z-index: 10;
    }

    .demo-prompt-message::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid var(--accent);
    }

    @keyframes bounce-down {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(5px); }
    }

    .demo-controls-bar .speed-select {
      padding: 8px 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      cursor: pointer;
    }

    .demo-controls-bar .divider {
      width: 1px;
      height: 30px;
      background: var(--border-light);
    }

    /* Demo Audio Controls */
    .demo-audio-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .demo-voice-select {
      padding: 8px 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      cursor: pointer;
    }

    .demo-audio-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .demo-audio-toggle:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .demo-audio-toggle.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .demo-audio-toggle i {
      font-size: 0.9rem;
    }

    /* Phase list clickable for audio */
    .phase-list li {
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .phase-list li:hover {
      color: var(--accent);
    }

    .phase-list li.speaking {
      color: var(--accent);
      font-weight: 600;
    }

    .phase-list li.speaking::before {
      content: '\f028';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-right: 6px;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Demo audio progress mini-bar */
    .demo-audio-progress {
      position: relative;
      width: 60px;
      height: 4px;
      background: var(--border-light);
      border-radius: 2px;
      overflow: hidden;
    }

    .demo-audio-progress .fill {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: var(--accent);
      transition: width 0.1s linear;
    }

    .demo-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      opacity: 0;
    }

    .demo-terminal {
      background: var(--grey-dark);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      max-height: 600px;
    }

    .demo-terminal-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 15px 20px;
      background: #1a1a1a;
      border-bottom: 1px solid #333;
    }

    .demo-terminal-header .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .demo-terminal-header .dot.red { background: #ef4444; }
    .demo-terminal-header .dot.yellow { background: #eab308; }
    .demo-terminal-header .dot.green { background: #22c55e; }

    .demo-terminal-header .title {
      flex: 1;
      text-align: center;
      color: #888;
      font-size: 0.8rem;
      font-family: 'SF Mono', 'Monaco', monospace;
    }

    .demo-terminal-content {
      flex: 1;
      padding: 20px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      line-height: 1.7;
      color: #f0f0f0;
      overflow-y: auto;
      min-height: 450px;
    }

    .demo-terminal-content::-webkit-scrollbar {
      width: 8px;
    }

    .demo-terminal-content::-webkit-scrollbar-track {
      background: #1a1a1a;
    }

    .demo-terminal-content::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }

    .demo-terminal-content .line {
      opacity: 0;
      transform: translateY(10px);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .demo-terminal-content .prompt { color: #888; }
    .demo-terminal-content .user { color: #22c55e; }
    .demo-terminal-content .ai { color: #BA0C2F; }
    .demo-terminal-content .output { color: #aaa; }
    .demo-terminal-content .highlight { color: #BA0C2F; font-weight: bold; }
    .demo-terminal-content .success { color: #22c55e; }
    .demo-terminal-content .error { color: #ef4444; }
    .demo-terminal-content .warning { color: #eab308; }
    .demo-terminal-content .dim { opacity: 0.5; }
    .demo-terminal-content .mcp-call { color: #60a5fa; }
    .demo-terminal-content .hook-block {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
      padding: 2px 0;
      display: block;
    }

    .demo-sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .demo-phase-indicator {
      border: 1px solid var(--border);
      padding: 20px;
      background: var(--bg);
    }

    .demo-phase-indicator h4 {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .demo-phase-indicator .phase-number {
      color: var(--accent);
      font-weight: bold;
    }

    .demo-progress-bar {
      height: 6px;
      background: var(--border-light);
      margin-bottom: 15px;
      position: relative;
    }

    .demo-progress-bar .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.3s ease;
    }

    .phase-list {
      list-style: none;
      max-height: 280px;
      overflow-y: auto;
    }

    .phase-list::-webkit-scrollbar {
      width: 4px;
    }

    .phase-list::-webkit-scrollbar-thumb {
      background: var(--border-light);
    }

    .phase-list li {
      padding: 6px 10px;
      font-size: 0.8rem;
      border-left: 2px solid var(--border-light);
      margin-bottom: 4px;
      color: var(--text-muted);
      transition: all 0.2s ease;
    }

    .phase-list li.active {
      border-color: var(--accent);
      color: var(--text);
      background: var(--accent-light);
    }

    .phase-list li.complete {
      border-color: var(--success);
      color: var(--text-muted);
    }

    .phase-list li.complete::before {
      content: "âœ“ ";
      color: var(--success);
    }

    .demo-explanation {
      border: 1px solid var(--border);
      padding: 20px;
      background: var(--bg);
      flex: 1;
    }

    .demo-explanation h4 {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      color: var(--accent);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .demo-explanation h4 i {
      font-size: 0.9rem;
    }

    .demo-explanation p {
      font-size: 0.85rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .demo-explanation .hook-badge {
      display: inline-block;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.7rem;
      background: rgba(186, 12, 47, 0.1);
      color: var(--accent);
      padding: 3px 8px;
      margin-top: 10px;
      border-left: 2px solid var(--accent);
    }

    .explanation-problem,
    .explanation-solution {
      margin-bottom: 12px;
      font-size: 0.85rem;
      line-height: 1.6;
    }

    .explanation-problem {
      color: var(--text-muted);
    }

    .explanation-problem strong {
      color: #ff6b6b;
      font-weight: 600;
    }

    .explanation-solution {
      color: var(--text);
    }

    .explanation-solution strong {
      color: var(--accent-green);
      font-weight: 600;
    }

    .demo-scene-indicator {
      text-align: center;
      margin-top: 15px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* ============================================
       SECTION 7: STATE FILE
       ============================================ */
    #state .section-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .state-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      opacity: 0;
      align-items: stretch;
    }

    .state-code {
      background: var(--grey-dark);
      border: 1px solid var(--border);
      padding: 30px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      line-height: 1.8;
      color: #f0f0f0;
      overflow-x: auto;
    }

    .state-code .key { color: #BA0C2F; }
    .state-code .string { color: #22c55e; }
    .state-code .number { color: #eab308; }
    .state-code .boolean { color: #60a5fa; }

    .state-explanation {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .state-field {
      border: 1px solid var(--border);
      padding: 20px;
      opacity: 0;
      transform: translateX(20px);
      flex: 1;
    }

    .state-field h4 {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9rem;
      color: var(--accent);
      margin-bottom: 10px;
    }

    .state-field p {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .state-highlight-box {
      border: 1px solid var(--accent);
      padding: 25px;
      background: rgba(186, 12, 47, 0.03);
    }

    .state-grid-top {
      margin-bottom: 40px;
    }

    .state-highlight-box h4 {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9rem;
      color: var(--accent);
      margin-bottom: 15px;
    }

    .state-highlight-box h4 i {
      font-size: 1.1rem;
    }

    .state-highlight-box .highlight-subtitle {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 10px;
      display: block;
    }

    .state-highlight-box p {
      font-size: 0.9rem;
      color: var(--text);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .state-highlight-box p:last-child {
      margin-bottom: 0;
    }

    .state-highlight-box code {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      background: rgba(186, 12, 47, 0.1);
      color: var(--accent);
      padding: 2px 6px;
    }

    .state-highlight-box .process-steps {
      list-style: none;
      margin-top: 15px;
    }

    .state-highlight-box .process-steps li {
      padding: 8px 0 8px 25px;
      position: relative;
      font-size: 0.85rem;
      color: var(--text-muted);
      border-left: 2px solid var(--border-light);
      margin-left: 5px;
    }

    .state-highlight-box .process-steps li::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 12px;
      width: 10px;
      height: 10px;
      background: var(--bg);
      border: 2px solid var(--accent);
    }

    .state-highlight-box .process-steps li.done::before {
      background: var(--accent);
    }

    .state-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-top: 30px;
    }

    .state-problem-label, .state-solution-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-light);
    }

    .state-problem-label {
      color: var(--text);
    }

    .state-problem-label i {
      color: var(--text-muted);
    }

    .state-solution-label {
      color: var(--accent);
      margin-top: 20px;
    }

    .state-problem-text {
      color: var(--text-muted);
      font-style: italic;
      margin-bottom: 15px;
    }

    .state-why {
      font-size: 0.85rem;
      color: var(--text);
      background: rgba(186, 12, 47, 0.05);
      padding: 10px 15px;
      border-left: 3px solid var(--accent);
      margin-top: 15px;
    }

    /* ============================================
       SECTION 8: INSTALLATION
       ============================================ */
    #install {
      text-align: center;
    }

    #install .section-header {
      margin-bottom: 20px;
    }

    .install-command {
      background: var(--grey-dark);
      border: 1px solid var(--border);
      padding: 25px 40px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1.1rem;
      color: #f0f0f0;
      display: inline-block;
      margin: 15px 0 25px;
      opacity: 0;
      transform: translateY(20px);
    }

    .install-command .prompt { color: #888; }
    .install-command .cmd { color: var(--accent); }

    .install-features {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin-top: 40px;
      text-align: left;
    }

    .install-feature {
      border: 1px solid var(--border);
      padding: 25px;
      opacity: 0;
      transform: translateY(20px);
    }

    .install-feature h4 {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .install-feature ul {
      list-style: none;
    }

    .install-feature li {
      font-size: 0.85rem;
      color: var(--text-muted);
      padding: 5px 0;
      padding-left: 15px;
      position: relative;
    }

    .install-feature li::before {
      content: '+';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-family: 'SF Mono', 'Monaco', monospace;
    }

    .install-links {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .install-links .btn i {
      margin-right: 8px;
    }

    .install-links .btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    /* ============================================
       SECTION 9: BUILT FOR CLAUDE CODE
       ============================================ */
    #credits {
      text-align: center;
    }

    .claude-features {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 25px;
      margin: 50px 0;
      text-align: left;
    }

    .claude-feature {
      border: 1px solid var(--border);
      padding: 25px;
      opacity: 0;
      transform: translateY(20px);
    }

    .claude-feature h4 {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9rem;
      margin-bottom: 12px;
    }

    .claude-feature h4 i {
      color: var(--accent);
    }

    .claude-feature p {
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .claude-feature p strong {
      color: var(--text);
    }

    .claude-feature p code {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      background: var(--bg-tertiary);
      padding: 2px 6px;
    }

    .credits-attribution {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-top: 40px;
    }

    .credits-attribution p {
      margin-bottom: 8px;
    }

    .credits-attribution i {
      color: var(--accent);
      margin-right: 8px;
      width: 18px;
    }

    .credits-attribution a {
      color: var(--accent);
      text-decoration: none;
    }

    .credits-attribution a:hover {
      text-decoration: underline;
    }

    .hustle-footer {
      margin-top: 30px;
      padding-top: 25px;
      border-top: 1px solid var(--border-light);
      text-align: center;
    }

    .hustle-footer span:first-child {
      color: var(--text-light);
      margin-right: 5px;
    }

    /* ============================================
       MOBILE RESPONSIVE
       ============================================ */
    @media (max-width: 1024px) {
      .phases-grid {
        grid-template-columns: 1fr;
      }

      .phase-card-main {
        grid-template-columns: 1fr;
      }

      .phase-info {
        border-right: none;
        border-bottom: 1px solid var(--border-light);
      }

      .demo-container {
        grid-template-columns: 1fr;
      }

      .state-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      section {
        padding: 80px 20px 40px;
      }

      h1 { font-size: 2.5rem; }
      h2 { font-size: 1.8rem; }

      .nav {
        padding: 15px 20px;
      }

      .nav-links {
        display: none;
      }

      .problem-grid {
        grid-template-columns: 1fr;
      }

      .solution-grid {
        grid-template-columns: 1fr;
      }

      .solution-pillars {
        grid-template-columns: 1fr;
      }

      .hook-types {
        grid-template-columns: 1fr;
      }

      .problem-solution-intro {
        grid-template-columns: 1fr;
        padding: 25px;
      }

      .ps-arrow {
        transform: rotate(90deg);
        justify-self: center;
      }

      .install-features {
        grid-template-columns: 1fr;
      }

      .solution-stats {
        gap: 30px;
      }

      .stat .number {
        font-size: 3rem;
      }

      .hero-terminal {
        padding: 20px;
      }

      .hero-buttons {
        flex-direction: column;
        align-items: center;
      }

      .exit-code-callout {
        grid-template-columns: 1fr;
        padding: 25px;
        gap: 20px;
      }

      .callout-icon {
        font-size: 2.5rem;
        justify-content: center;
      }

      .callout-comparison {
        flex-direction: column;
        gap: 10px;
      }

      .comparison-item {
        width: 100%;
      }

      .grounding-tools {
        grid-template-columns: 1fr;
      }

      .grounding-enforcement {
        padding: 20px;
      }

      .grounding-enforcement h4 {
        font-size: 0.9rem;
      }
    }

    /* ============================================
       NARRATION BAR - Bottom Fixed Audio Player
       ============================================ */
    .narration-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--grey-dark);
      border-top: 2px solid var(--accent);
      padding: 15px 30px;
      z-index: 1001;
      transition: transform 0.3s ease;
    }

    .narration-bar.hidden {
      transform: translateY(100%);
    }

    .narration-controls {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 10px;
    }

    .narration-btn {
      background: transparent;
      border: 1px solid #555;
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .narration-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .narration-progress {
      flex: 1;
      position: relative;
    }

    .narration-progress .progress-track {
      height: 8px;
      background: #333;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
    }

    .narration-progress .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      width: 0%;
      transition: width 0.1s linear;
    }

    .narration-progress .progress-handle {
      position: absolute;
      top: -4px;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      transform: translateX(-50%);
      cursor: grab;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      left: 0%;
    }

    .narration-progress .section-markers {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      pointer-events: none;
    }

    .narration-progress .section-marker {
      position: absolute;
      width: 2px;
      height: 100%;
      background: rgba(255,255,255,0.4);
      cursor: pointer;
      pointer-events: auto;
    }

    .narration-progress .section-marker:hover {
      background: var(--accent);
    }

    .narration-progress .section-marker .section-label {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      font-size: 0.65rem;
      color: #888;
      padding: 2px 4px;
      background: rgba(0,0,0,0.7);
      border-radius: 3px;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
      margin-bottom: 4px;
    }

    .narration-progress .section-marker:hover .section-label {
      opacity: 1;
    }

    /* Always visible section labels */
    .narration-progress .section-labels {
      position: absolute;
      top: -18px;
      left: 0;
      right: 0;
      height: 16px;
      pointer-events: none;
    }

    .narration-progress .section-label-fixed {
      position: absolute;
      font-size: 0.6rem;
      color: #666;
      white-space: nowrap;
      transform: translateX(-50%);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .narration-time {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.85rem;
      color: #999;
      min-width: 90px;
      text-align: center;
    }

    .narration-subtitles {
      text-align: center;
      font-size: 1.05rem;
      color: #f0f0f0;
      min-height: 1.5em;
      line-height: 1.4;
    }

    .narration-subtitles .highlight {
      color: var(--accent);
      font-weight: 600;
    }

    /* Launch button - shown when bar is hidden */
    .narration-launch-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 15px 25px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(186, 12, 47, 0.4);
      z-index: 999;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', system-ui, sans-serif;
    }

    .narration-launch-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(186, 12, 47, 0.5);
    }

    .narration-launch-btn.hidden {
      display: none;
    }

    /* Voice selector panel */
    .voice-selector {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #1a1a1a;
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 20px;
      z-index: 1000;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
      display: none;
      flex-direction: column;
      gap: 15px;
      min-width: 280px;
    }

    .voice-selector.visible {
      display: flex;
    }

    .voice-selector h4 {
      margin: 0;
      color: #fff;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .voice-selector-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .voice-selector-close:hover {
      color: #fff;
    }

    .voice-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .voice-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      background: #252525;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      color: #fff;
    }

    .voice-option:hover {
      background: #333;
      border-color: #444;
    }

    .voice-option.selected {
      border-color: var(--accent);
      background: rgba(186, 12, 47, 0.15);
    }

    .voice-option .voice-icon {
      font-size: 1.5rem;
      width: 40px;
      text-align: center;
    }

    .voice-option .voice-info {
      flex: 1;
    }

    .voice-option .voice-name {
      font-weight: 600;
      font-size: 1rem;
    }

    .voice-option .voice-desc {
      font-size: 0.8rem;
      color: #888;
      margin-top: 2px;
    }

    /* Disabled voice option */
    .voice-option.voice-disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .voice-option.voice-disabled .voice-desc {
      color: #666;
      font-style: italic;
    }

    /* Christmas themed Santa option */
    .voice-option.santa-option {
      background: linear-gradient(135deg, #2a1a1a 0%, #1a1a1a 100%);
      position: relative;
      overflow: hidden;
    }

    .voice-option.santa-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #c41e3a, #ffffff, #c41e3a, #ffffff);
      background-size: 200% 100%;
      animation: christmas-lights 2s linear infinite;
    }

    @keyframes christmas-lights {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }

    .voice-option.santa-option:hover {
      background: linear-gradient(135deg, #3a2525 0%, #252525 100%);
    }

    .voice-option.santa-option .voice-icon {
      position: relative;
      color: #228b22;
    }

    .snowflakes {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .snowflake {
      position: absolute;
      color: rgba(255, 255, 255, 0.6);
      font-size: 10px;
      animation: snowfall 3s linear infinite;
    }

    .snowflake:nth-child(1) { left: 10%; animation-delay: 0s; }
    .snowflake:nth-child(2) { left: 30%; animation-delay: 0.5s; }
    .snowflake:nth-child(3) { left: 50%; animation-delay: 1s; }
    .snowflake:nth-child(4) { left: 70%; animation-delay: 1.5s; }
    .snowflake:nth-child(5) { left: 90%; animation-delay: 2s; }

    @keyframes snowfall {
      0% { transform: translateY(-10px) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(60px) rotate(360deg); opacity: 0; }
    }

    .voice-selector-play {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 5px;
      transition: all 0.2s;
    }

    .voice-selector-play:hover {
      background: #d41030;
      transform: translateY(-1px);
    }

    .voice-selector-play:disabled {
      background: #444;
      cursor: not-allowed;
      transform: none;
    }

    .voice-note {
      font-size: 0.75rem;
      color: #666;
      text-align: center;
      margin-top: 5px;
    }

    /* Highlight animation for elements when narration mentions them */
    .narration-highlight {
      transition: all 0.3s ease;
    }

    /* Mobile adjustments for narration bar */
    @media (max-width: 768px) {
      .narration-bar {
        padding: 10px 15px;
      }

      .narration-controls {
        gap: 10px;
      }

      .narration-time {
        display: none;
      }

      .narration-subtitles {
        font-size: 0.9rem;
      }

      .narration-launch-btn {
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Background Grid -->
  <div class="background-grid"></div>

  <!-- Floating Geometric Shapes -->
  <div class="floating-shapes" id="floating-shapes"></div>

  <!-- Navigation -->
  <nav class="nav">
    <a href="https://hustle-together.com" class="nav-brand"><span class="hustle-brand">Hustle Together</span></a>
    <div class="nav-links">
      <a href="https://github.com/hustle-together/api-dev-tools" class="nav-btn"><i class="fa-brands fa-github"></i> GitHub</a>
      <a href="https://www.npmjs.com/package/@hustle-together/api-dev-tools" class="nav-btn"><i class="fa-brands fa-npm"></i> npm</a>
      <a href="https://github.com/hustle-together/api-dev-tools#readme" class="nav-btn primary"><i class="fa-solid fa-book"></i> Docs</a>
    </div>
  </nav>

  <!-- Section 1: Hero -->
  <section id="hero">
    <div class="section-inner">
      <div class="hero-badge">v1.0.0 - Exit Code 2 Enforcement</div>

      <h1 class="hero-title">
        API Dev Tools
        <span class="package-name">@hustle-together/api-dev-tools</span>
      </h1>

      <p class="hero-tagline">
        Interview-driven, research-first API development workflow with continuous verification loops for Claude Code
      </p>

      <div class="hero-terminal">
        <div class="terminal-header">
          <div class="terminal-dot red"></div>
          <div class="terminal-dot yellow"></div>
          <div class="terminal-dot green"></div>
        </div>
        <pre><span class="prompt">~/project $</span> <span class="command" id="hero-command"></span><span class="cursor-blink"></span></pre>
      </div>

      <div class="hero-buttons">
        <a href="https://github.com/hustle-together/api-dev-tools#readme" class="btn primary">Read Documentation</a>
        <a href="#problem" class="btn">See the Problem</a>
      </div>
    </div>

    <div class="scroll-indicator">scroll to explore</div>
  </section>

  <!-- Section 2: The Problem -->
  <section id="problem">
    <div class="section-inner">
      <div class="section-header">
        <h2>The Problem</h2>
        <p class="text-muted">6 failure modes that break AI-assisted API development</p>
      </div>

      <div class="problem-grid">
        <div class="problem-card">
          <div class="card-header">
            <div class="icon"><i class="fa-solid fa-clock-rotate-left"></i></div>
            <h3>Outdated Documentation</h3>
          </div>
          <span class="issue-label">The Issue</span>
          <p class="issue-text">AI uses training data that can be months or years old. APIs change constantly with new endpoints, deprecated parameters, and different auth methods.</p>
          <span class="why-label">Why It Matters</span>
          <p class="why-text">Your implementation breaks on day one. The AI confidently writes code for endpoints that no longer exist or parameters that have been renamed.</p>
        </div>

        <div class="problem-card">
          <div class="card-header">
            <div class="icon"><i class="fa-solid fa-brain"></i></div>
            <h3>Memory-Based Implementation</h3>
          </div>
          <span class="issue-label">The Issue</span>
          <p class="issue-text">Even after researching current docs, AI "forgets" by implementation time and falls back to training patterns that don't match what it just read.</p>
          <span class="why-label">Why It Matters</span>
          <p class="why-text">Research is wasted. The AI reads the correct docs, then writes code based on stale memory instead of the actual API structure it discovered.</p>
        </div>

        <div class="problem-card">
          <div class="card-header">
            <div class="icon"><i class="fa-solid fa-comments"></i></div>
            <h3>Self-Answering Questions</h3>
          </div>
          <span class="issue-label">The Issue</span>
          <p class="issue-text">AI asks "What format do you want?" then immediately answers itself with assumptions. Your actual requirements never get captured.</p>
          <span class="why-label">Why It Matters</span>
          <p class="why-text">You end up with someone else's preferences baked into your code. The AI builds what it thinks you want, not what you actually need.</p>
        </div>

        <div class="problem-card">
          <div class="card-header">
            <div class="icon"><i class="fa-solid fa-hourglass-half"></i></div>
            <h3>Context Dilution</h3>
          </div>
          <span class="issue-label">The Issue</span>
          <p class="issue-text">In long sessions, early decisions fade from the context window. By implementation time, the AI has "forgotten" what you agreed on.</p>
          <span class="why-label">Why It Matters</span>
          <p class="why-text">Turn 47 doesn't remember Turn 3. That caching strategy you carefully specified? Gone. The error format you chose? Replaced with defaults.</p>
        </div>

        <div class="problem-card">
          <div class="card-header">
            <div class="icon"><i class="fa-solid fa-check-double"></i></div>
            <h3>Skipped Verification</h3>
          </div>
          <span class="issue-label">The Issue</span>
          <p class="issue-text">AI claims "done!" without checking if implementation actually matches the documentation. Memory-based errors slip through uncaught.</p>
          <span class="why-label">Why It Matters</span>
          <p class="why-text">Tests pass but the API fails in production. The code works for the wrong version of the API, and nobody noticed until customers reported errors.</p>
        </div>

        <div class="problem-card">
          <div class="card-header">
            <div class="icon"><i class="fa-solid fa-shield-halved"></i></div>
            <h3>No Enforcement Mechanism</h3>
          </div>
          <span class="issue-label">The Issue</span>
          <p class="issue-text">Even with good intentions, nothing FORCES the AI to follow the workflow. It can skip steps whenever convenient or when context is lost.</p>
          <span class="why-label">Why It Matters</span>
          <p class="why-text">Workflows become suggestions. Without hard blocks, the AI takes shortcuts under pressure, reverting to fast-but-broken patterns that cause rework.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 3: The Solution -->
  <section id="solution">
    <div class="section-inner">
      <div class="section-header">
        <h2>The Solution</h2>
        <p class="text-muted">6 solutions that directly address each problem with Python hooks that BLOCK progress</p>
      </div>

      <div class="solution-stats">
        <div class="stat">
          <div class="number">12</div>
          <div class="label">Phases</div>
        </div>
        <div class="stat">
          <div class="number">18</div>
          <div class="label">Hooks</div>
        </div>
        <div class="stat">
          <div class="number">24</div>
          <div class="label">Commands</div>
        </div>
      </div>

      <div class="solution-grid">
        <div class="solution-card">
          <div class="solves-badge"><i class="fa-solid fa-arrow-right"></i> Solves: Outdated Documentation</div>
          <h3><i class="fa-solid fa-magnifying-glass"></i> Research-First Enforcement</h3>
          <p class="description">Blocks ALL implementation until Context7 or WebSearch fetches current documentation. No cached or training-data-based code allowed.</p>
          <div class="hook-name">enforce-research.py</div>
        </div>

        <div class="solution-card">
          <div class="solves-badge"><i class="fa-solid fa-arrow-right"></i> Solves: Memory-Based Implementation</div>
          <h3><i class="fa-solid fa-rotate"></i> Verification Loop</h3>
          <p class="description">Re-fetches documentation AFTER tests pass and compares to implementation. Catches memory-based drift that happened during coding.</p>
          <div class="hook-name">verify-after-green.py</div>
        </div>

        <div class="solution-card">
          <div class="solves-badge"><i class="fa-solid fa-arrow-right"></i> Solves: Self-Answering Questions</div>
          <h3><i class="fa-solid fa-user-check"></i> Interview Enforcement</h3>
          <p class="description">Requires AskUserQuestion tool with structured numbered options. Detects self-answers and blocks until human confirmation received.</p>
          <div class="hook-name">enforce-interview.py</div>
        </div>

        <div class="solution-card">
          <div class="solves-badge"><i class="fa-solid fa-arrow-right"></i> Solves: Context Dilution</div>
          <h3><i class="fa-solid fa-arrows-rotate"></i> Periodic Re-grounding</h3>
          <p class="description">Re-injects interview decisions and current phase every 7 turns. Uses <code>phase_exit_confirmed</code> to track explicit user approval.</p>
          <div class="hook-name">periodic-reground.py</div>
        </div>

        <div class="solution-card">
          <div class="solves-badge"><i class="fa-solid fa-arrow-right"></i> Solves: Skipped Verification</div>
          <h3><i class="fa-solid fa-clipboard-check"></i> Automatic Re-research</h3>
          <p class="description">Triggers automatically when tests pass. Re-fetches docs, builds comparison table, loops back if implementation doesn't match.</p>
          <div class="hook-name">verify-after-green.py (PostToolUse)</div>
        </div>

        <div class="solution-card">
          <div class="solves-badge"><i class="fa-solid fa-arrow-right"></i> Solves: No Enforcement Mechanism</div>
          <h3><i class="fa-solid fa-ban"></i> Exit Code 2 Blocking</h3>
          <p class="description">Hooks use <code>sys.exit(2)</code> to block actions and show errors to Claude. Cannot proceed until workflow requirements are met.</p>
          <div class="hook-name">18 Python hooks across all phases</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 4: Research Grounding -->
  <section id="grounding">
    <div class="section-inner">
      <div class="section-header">
        <h2>Research Grounding</h2>
        <p class="text-muted">Current documentation, not stale training data.</p>
      </div>

      <!-- Problem/Solution Framing -->
      <div class="problem-solution-intro">
        <div class="ps-problem">
          <h3><i class="fa-solid fa-exclamation-triangle"></i> The Problem</h3>
          <p>AI training data is months or years old. APIs change constantly - new endpoints, deprecated parameters, different authentication methods. <strong>Your implementation breaks on day one</strong> because it's based on outdated information.</p>
        </div>
        <div class="ps-arrow"><i class="fa-solid fa-arrow-right"></i></div>
        <div class="ps-solution">
          <h3><i class="fa-solid fa-magnifying-glass"></i> The Solution</h3>
          <p>Require <strong>current documentation</strong> before any implementation. Two MCP tools provide live research: <strong>Context7</strong> for library docs and <strong>WebSearch</strong> for official API documentation.</p>
        </div>
      </div>

      <div class="grounding-tools">
        <div class="grounding-tool">
          <div class="tool-header">
            <i class="fa-solid fa-book"></i>
            <h3>Context7 MCP</h3>
          </div>
          <p class="tool-description">Fetches current library documentation directly from source. Always up-to-date, always accurate.</p>
          <div class="tool-example">
            <code>mcp__context7__resolve-library-id</code><br>
            <code>mcp__context7__get-library-docs</code>
          </div>
          <p class="tool-why"><strong>Why it matters:</strong> SDK and library docs change frequently. Context7 gives you the actual current API surface, not what Claude remembers from training.</p>
        </div>

        <div class="grounding-tool">
          <div class="tool-header">
            <i class="fa-solid fa-globe"></i>
            <h3>WebSearch</h3>
          </div>
          <p class="tool-description">Searches the web for official documentation, recent changes, rate limits, and authentication requirements.</p>
          <div class="tool-example">
            <code>WebSearch: "[API] authentication 2024"</code><br>
            <code>WebSearch: "[API] rate limits"</code>
          </div>
          <p class="tool-why"><strong>Why it matters:</strong> Official docs have info that SDKs don't expose. WebSearch finds deprecation notices, new features, and known issues.</p>
        </div>
      </div>

      <div class="grounding-enforcement">
        <h4><i class="fa-solid fa-lock"></i> Enforcement: enforce-research.py</h4>
        <p>This hook blocks all Write/Edit operations on API files until research is complete. No documentation = no implementation.</p>
      </div>
    </div>
  </section>

  <!-- Section 5: Hook System -->
  <section id="hooks">
    <div class="section-inner">
      <div class="section-header">
        <h2>Workflow Enforcement</h2>
        <p class="text-muted">The problem: AI can skip steps. The solution: hooks that block progress until phases complete.</p>
      </div>

      <!-- Problem/Solution Framing -->
      <div class="problem-solution-intro">
        <div class="ps-problem">
          <h3><i class="fa-solid fa-exclamation-triangle"></i> The Problem</h3>
          <p>Even with the best workflow, AI can simply <strong>ignore instructions</strong> and skip steps. Tell it to research first? It might just start coding. Ask it to interview you? It might answer its own questions. There's no enforcement mechanism - just suggestions it can bypass.</p>
        </div>
        <div class="ps-arrow"><i class="fa-solid fa-arrow-right"></i></div>
        <div class="ps-solution">
          <h3><i class="fa-solid fa-shield-halved"></i> The Solution</h3>
          <p><strong>18 Python hooks</strong> that intercept Claude's actions and <strong>block operations</strong> that violate the workflow. When blocked, Claude sees the error message and cannot proceed until the issue is resolved.</p>
        </div>
      </div>

      <div class="hook-types">
        <div class="hook-type">
          <h3><i class="fa-solid fa-shield"></i> PreToolUse</h3>
          <p>Runs BEFORE Claude can write/edit files. Blocks if research or interview incomplete.</p>
          <div class="count">12 hooks</div>
        </div>

        <div class="hook-type">
          <h3><i class="fa-solid fa-check-double"></i> PostToolUse</h3>
          <p>Runs AFTER tool execution. Triggers verification phases when tests pass.</p>
          <div class="count">4 hooks</div>
        </div>

        <div class="hook-type">
          <h3><i class="fa-solid fa-stop"></i> Stop</h3>
          <p>Runs when Claude tries to end conversation. Blocks if workflow phases incomplete.</p>
          <div class="count">2 hooks</div>
        </div>
      </div>

      <!-- Exit Code 2 Explanation -->
      <div class="exit-code-callout">
        <div class="callout-icon">
          <i class="fa-solid fa-code"></i>
        </div>
        <div class="callout-content">
          <h3>How It Works: Exit Code 2</h3>
          <p>Claude Code hooks can return different exit codes. <code>Exit code 2</code> blocks the action and sends the error message (stderr) to Claude, who sees it as context for what went wrong.</p>
          <div class="callout-comparison">
            <div class="comparison-item">
              <div class="comparison-label">Exit 0</div>
              <div class="comparison-text">Allow the operation</div>
            </div>
            <div class="comparison-item">
              <div class="comparison-label">Exit 1</div>
              <div class="comparison-text">Non-blocking error (continues)</div>
            </div>
            <div class="comparison-item highlight">
              <div class="comparison-label">Exit 2</div>
              <div class="comparison-text">Block action + show error to Claude</div>
            </div>
          </div>
        </div>
      </div>

      <div class="exit-code-demo">
        <h3>
          <i class="fa-solid fa-terminal"></i> Example: What Happens When Claude Tries to Skip Research
        </h3>
        <div class="exit-code-terminal">
<span class="dim">~/project $</span> <span class="output">claude: attempting to write route.ts...</span>

<span class="error">BLOCKED: enforce-research.py (exit code 2)</span>

<span class="warning">Research required before implementation!</span>
<span class="output">
Current phase: interview (complete)
Missing: research_initial, research_deep

Required actions:
  1. Use Context7 to fetch library documentation
  2. Use WebSearch for recent API changes
  3. Document findings in .claude/research/</span>

<span class="dim">~/project $</span> <span class="success">Claude sees this error and cannot proceed until research is complete</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 5: The 12 Phases -->
  <section id="phases">
    <div class="section-inner">
      <div class="section-header">
        <h2>The 12 Phases</h2>
        <p class="text-muted">Each phase must complete before proceeding. Click EXPAND for details.</p>
      </div>

      <div class="phases-grid">
        <!-- Phase 0: Disambiguation -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 0</span>
              <h4>Disambiguation</h4>
              <p>Clarify ambiguous terms before any research begins.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-disambiguation.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">AI:</span> <span class="output">You mentioned "AI client"</span>
<span class="output">Which do you mean?</span>
<span class="highlight">[1]</span> <span class="output">Vercel AI SDK client</span>
<span class="highlight">[2]</span> <span class="output">OpenAI client directly</span>
<span class="highlight">[3]</span> <span class="output">Custom wrapper class</span>

<span class="prompt">User:</span> <span class="cmd">1</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>When This Runs</h5>
              <ul>
                <li>User request contains ambiguous terms</li>
                <li>Multiple interpretations possible</li>
                <li>Technical terms need clarification</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.disambiguation.clarified_terms</code><br>
                <code>phases.disambiguation.user_choices</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 1: Scope -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 1</span>
              <h4>Scope Confirmation</h4>
              <p>Confirm understanding of what endpoint should do.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-scope.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">AI:</span> <span class="output">Creating /api/v2/brandfetch</span>

<span class="output">Purpose: Fetch brand data</span>
<span class="output">Input: domain name</span>
<span class="output">Output: logo, colors, fonts</span>

<span class="prompt">Correct?</span> <span class="success">[Y/n]</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>What Gets Confirmed</h5>
              <ul>
                <li>Endpoint path and HTTP methods</li>
                <li>Expected input parameters</li>
                <li>Expected output format</li>
                <li>Error handling approach</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.scope.endpoint_path</code><br>
                <code>phases.scope.confirmed</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 2: Initial Research -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 2</span>
              <h4>Initial Research</h4>
              <p>Fetch documentation via Context7 or WebSearch.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-research.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">AI:</span> <span class="output">Researching Brandfetch API...</span>

<span class="highlight">Context7:</span> <span class="output">Found 23 endpoints</span>
<span class="highlight">WebSearch:</span> <span class="output">v2 released 2024</span>

<span class="output">Discovered params:</span>
  <span class="success">+ domain (required)</span>
  <span class="success">+ format: svg|png</span>
  <span class="success">+ size: 128|256|512</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Research Requirements</h5>
              <ul>
                <li>Must use Context7 or WebSearch (not memory)</li>
                <li>Document all discovered parameters</li>
                <li>Note API version and date</li>
                <li>Cache findings in .claude/research/</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.research_initial.sources[]</code><br>
                <code>phases.research_initial.discovered_params[]</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 3: Interview -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 3</span>
              <h4>Interview</h4>
              <p>Ask questions FROM research findings, not templates.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-interview.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">AI:</span> <span class="output">Based on research:</span>

<span class="output">Logo format preference?</span>
<span class="highlight">[1]</span> <span class="output">SVG (scalable)</span>
<span class="highlight">[2]</span> <span class="output">PNG (compatibility)</span>
<span class="highlight">[3]</span> <span class="output">Both (let user choose)</span>

<span class="prompt">User:</span> <span class="cmd">3</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Interview Rules</h5>
              <ul>
                <li>Questions must reference discovered params</li>
                <li>No generic template questions</li>
                <li>Provide numbered options when possible</li>
                <li>Decisions injected into every Write operation</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.interview.questions[]</code><br>
                <code>phases.interview.decisions[]</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 4: Deep Research -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 4</span>
              <h4>Deep Research</h4>
              <p>Research additional topics based on interview answers.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-deep-research.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">AI:</span> <span class="output">User chose "Both formats"</span>
<span class="output">Researching format handling...</span>

<span class="highlight">Found:</span> <span class="output">SVG requires</span>
<span class="output">Content-Type negotiation</span>

<span class="success">Added to implementation notes</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>When Deep Research Triggers</h5>
              <ul>
                <li>User selects complex option</li>
                <li>Interview reveals edge cases</li>
                <li>Implementation requires specialized knowledge</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.research_deep.topics[]</code><br>
                <code>phases.research_deep.findings[]</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 5: Schema Creation -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 5</span>
              <h4>Schema Creation</h4>
              <p>Create Zod schemas from research + interview decisions.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-schema.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">Creating schema...</span>

<span class="highlight">const RequestSchema = z.object({</span>
  <span class="output">domain: z.string(),</span>
  <span class="output">format: z.enum(['svg','png'])</span>
    <span class="output">.optional(),</span>
<span class="highlight">});</span>

<span class="success">Schema matches research</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Schema Requirements</h5>
              <ul>
                <li>All discovered params must be represented</li>
                <li>Types match documentation exactly</li>
                <li>Validation rules from research</li>
                <li>Interview decisions reflected in defaults</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.schema_creation.request_schema</code><br>
                <code>phases.schema_creation.response_schema</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 6: Environment Check -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 6</span>
              <h4>Environment Check</h4>
              <p>Verify required API keys and environment setup.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-environment.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">Checking environment...</span>

<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">BRANDFETCH_API_KEY</span>
<span class="warning"><i class="fa-solid fa-triangle-exclamation"></i></span> <span class="output">BRANDFETCH_CLIENT_ID</span>
    <span class="dim">(optional, for rate limits)</span>

<span class="success">Environment ready</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>What Gets Checked</h5>
              <ul>
                <li>Required API keys exist</li>
                <li>Optional keys noted</li>
                <li>Environment variable naming matches docs</li>
                <li>Key format validation if possible</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.environment.required_keys[]</code><br>
                <code>phases.environment.verified</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 7: TDD Red -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 7</span>
              <h4>TDD Red Phase</h4>
              <p>Write failing tests BEFORE any implementation.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-tdd-red.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">$</span> <span class="cmd">pnpm test:run</span>

<span class="error">FAIL</span> <span class="output">brandfetch.test.ts</span>
  <span class="error"><i class="fa-solid fa-xmark"></i></span> <span class="output">returns logo for valid domain</span>
  <span class="error"><i class="fa-solid fa-xmark"></i></span> <span class="output">handles invalid domain</span>
  <span class="error"><i class="fa-solid fa-xmark"></i></span> <span class="output">respects format parameter</span>

<span class="error">3 tests failed</span> <span class="dim">(expected)</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>TDD Red Requirements</h5>
              <ul>
                <li>Tests must fail initially</li>
                <li>Cover all interview decisions</li>
                <li>Test discovered parameters</li>
                <li>Include error cases from docs</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.tdd_red.test_file</code><br>
                <code>phases.tdd_red.failing_tests[]</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 8: TDD Green -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 8</span>
              <h4>TDD Green Phase</h4>
              <p>Minimal implementation to make tests pass.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> verify-after-green.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">$</span> <span class="cmd">pnpm test:run</span>

<span class="success">PASS</span> <span class="output">brandfetch.test.ts</span>
  <span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">returns logo for valid domain</span>
  <span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">handles invalid domain</span>
  <span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">respects format parameter</span>

<span class="success">3 tests passed</span>
<span class="warning">Triggering Phase 9: Verify</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Green Phase Rules</h5>
              <ul>
                <li>Write minimal code to pass tests</li>
                <li>No premature optimization</li>
                <li>Interview decisions in comments</li>
                <li>When tests pass, triggers Phase 9 automatically</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.tdd_green.implementation_file</code><br>
                <code>phases.tdd_green.tests_passing</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 9: Verify -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 9</span>
              <h4>Verification</h4>
              <p>Re-research docs and compare to implementation.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-verify.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">Verifying implementation...</span>

<span class="output">Re-fetching Brandfetch docs...</span>
<span class="output">Comparing to route.ts...</span>

<span class="warning"><i class="fa-solid fa-triangle-exclamation"></i></span> <span class="output">Missing: size parameter</span>
    <span class="dim">Docs show: 128|256|512</span>
    <span class="dim">Implementation: not found</span>

<span class="error">Loop back to Phase 8</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Verification Checks</h5>
              <ul>
                <li>Re-fetch documentation (not from cache)</li>
                <li>Compare all params to implementation</li>
                <li>Verify error handling matches docs</li>
                <li>If mismatch found, loop back to Phase 8</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.verify.mismatches[]</code><br>
                <code>phases.verify.loop_count</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 10: TDD Refactor -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 10</span>
              <h4>TDD Refactor</h4>
              <p>Clean up code while keeping tests green.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-refactor.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">Refactoring...</span>

<span class="output">- Extract validation helper</span>
<span class="output">- Add JSDoc comments</span>
<span class="output">- Improve error messages</span>

<span class="prompt">$</span> <span class="cmd">pnpm test:run</span>
<span class="success">3 tests still passing</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Refactor Rules</h5>
              <ul>
                <li>Tests must stay green throughout</li>
                <li>Extract reusable utilities</li>
                <li>Add documentation</li>
                <li>No new functionality</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.tdd_refactor.changes[]</code><br>
                <code>phases.tdd_refactor.tests_still_passing</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 11: Documentation -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 11</span>
              <h4>Documentation</h4>
              <p>Update manifests and cache research findings.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> enforce-documentation.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">Updating docs...</span>

<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">api-tests-manifest.json</span>
<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">OpenAPI spec</span>
<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">.claude/research/brandfetch/</span>

<span class="success">Documentation complete</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Documentation Updates</h5>
              <ul>
                <li>Update API test manifest</li>
                <li>Update OpenAPI specification</li>
                <li>Cache research in .claude/research/</li>
                <li>Add code examples</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.documentation.files_updated[]</code><br>
                <code>phases.documentation.research_cached</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 12: Completion -->
        <div class="phase-card">
          <div class="phase-card-main">
            <div class="phase-info">
              <span class="phase-number">PHASE 12</span>
              <h4>Completion</h4>
              <p>Final verification and commit.</p>
              <span class="phase-hook"><i class="fa-solid fa-lock"></i> api-workflow-check.py</span>
            </div>
            <div class="phase-terminal">
              <div class="terminal-title">~/project</div>
              <pre><span class="prompt">Final check...</span>

<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">All 12 phases complete</span>
<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">Tests passing</span>
<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">Docs updated</span>
<span class="success"><i class="fa-solid fa-check"></i></span> <span class="output">Research cached</span>

<span class="prompt">$</span> <span class="cmd">git commit</span>
<span class="success">feat(api): add brandfetch endpoint</span></pre>
            </div>
          </div>
          <button class="expand-btn" onclick="toggleExpand(this)">
            <span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS
          </button>
          <div class="phase-details">
            <div class="phase-details-inner">
              <h5>Completion Checklist</h5>
              <ul>
                <li>All phases marked complete in state</li>
                <li>No unaddressed verification warnings</li>
                <li>Implementation matches interview decisions</li>
                <li>Git diff matches claimed changes</li>
              </ul>
              <h5>State Fields Tracked</h5>
              <div class="state-fields">
                <code>phases.completion.verified</code><br>
                <code>files_created[]</code>, <code>files_modified[]</code>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 6: Terminal Demo -->
  <section id="demo">
    <div class="section-inner">
      <div class="section-header">
        <h2>See It In Action</h2>
        <p class="text-muted">Watch the complete 12-phase workflow: /api-create brandfetch</p>
      </div>

      <div class="demo-controls-bar">
        <div class="control-group">
          <button class="control-btn" id="demo-prev" disabled><i class="fa-solid fa-backward-step"></i> Prev</button>
          <button class="control-btn" id="demo-play"><i class="fa-solid fa-play"></i> Auto-play</button>
          <button class="control-btn" id="demo-next"><i class="fa-solid fa-forward-step"></i> Next</button>
        </div>
        <div class="divider"></div>
        <div class="control-group">
          <button class="control-btn" id="demo-reset"><i class="fa-solid fa-rotate-right"></i> Reset</button>
          <select class="speed-select" id="demo-speed">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="2">2x</option>
            <option value="3">3x</option>
          </select>
        </div>
        <div class="divider"></div>
        <div class="control-group">
          <button class="control-btn" id="demo-skip-error">Skip to Error Demo</button>
        </div>
        <div class="divider"></div>
        <div class="control-group demo-audio-group">
          <button class="demo-audio-toggle" id="demo-audio-toggle" title="Toggle narration audio">
            <i class="fa-solid fa-volume-xmark"></i> Audio Off
          </button>
          <div class="demo-audio-progress" id="demo-audio-progress" style="display: none;">
            <div class="fill" id="demo-audio-fill"></div>
          </div>
        </div>
      </div>

      <div class="demo-container">
        <div class="demo-terminal">
          <div class="demo-terminal-header">
            <div class="dot red"></div>
            <div class="dot yellow"></div>
            <div class="dot green"></div>
            <span class="title">~/project - claude</span>
          </div>
          <div class="demo-terminal-content" id="demo-content">
            <!-- Lines will be added dynamically -->
          </div>
        </div>

        <div class="demo-sidebar">
          <div class="demo-phase-indicator">
            <h4>
              <span>Current Phase</span>
              <span class="phase-number" id="phase-number">0/12</span>
            </h4>
            <div class="demo-progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <ul class="phase-list" id="phase-list">
              <li data-phase="0">Disambiguation</li>
              <li data-phase="1">Scope</li>
              <li data-phase="2">Initial Research</li>
              <li data-phase="3">Interview</li>
              <li data-phase="4">Deep Research</li>
              <li data-phase="5">Schema</li>
              <li data-phase="6">Environment</li>
              <li data-phase="7">TDD Red</li>
              <li data-phase="8">TDD Green</li>
              <li data-phase="9">Verify</li>
              <li data-phase="10">Refactor</li>
              <li data-phase="11">Documentation</li>
              <li data-phase="12">Complete</li>
            </ul>
          </div>

          <div class="demo-explanation">
            <h4><i class="fa-solid fa-circle-info" id="demo-explanation-icon"></i> <span id="demo-explanation-title">Ready to Start</span></h4>
            <p id="demo-explanation-text">Click Auto-play to watch the full workflow, or use Next/Prev to step through manually.</p>
            <div class="hook-badge" id="demo-hook-badge" style="display: none;"></div>
          </div>

          <div class="demo-scene-indicator" id="demo-scene-indicator">
            Scene 1 of 14
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 7: State File -->
  <section id="state">
    <div class="section-inner">
      <div class="section-header">
        <h2>Persistent Memory</h2>
        <p class="text-muted">Two problems with AI memory. Two solutions built into state tracking.</p>
      </div>

      <!-- Problem/Solution boxes - FIRST (emphasized) -->
      <div class="state-grid state-grid-top">
        <div class="state-highlight-box">
          <div class="state-problem-label"><i class="fa-solid fa-exclamation-circle"></i> Problem: Self-Answering</div>
          <p class="state-problem-text">AI asks "What format do you want?" then immediately answers itself. Your requirements never get captured. It claims to have "asked" but really just assumed.</p>

          <div class="state-solution-label"><i class="fa-solid fa-check-circle"></i> Solution: phase_exit_confirmed</div>
          <p>State tracking detects when Claude asks an exit question AND the user responds affirmatively:</p>

          <ol class="process-steps">
            <li class="done">Claude asks exit question: "Ready to proceed?"</li>
            <li class="done">User responds: "yes" / "approve" / "looks good"</li>
            <li class="done">track-tool-use.py detects BOTH conditions</li>
            <li class="done">Sets: <code>phase_exit_confirmed: true</code></li>
          </ol>

          <p class="state-why"><strong>Why it matters:</strong> Hooks can check this flag before allowing phase transitions. If Claude tries to skip user input, the flag remains false and hooks can block progress.</p>
        </div>

        <div class="state-highlight-box">
          <div class="state-problem-label"><i class="fa-solid fa-exclamation-circle"></i> Problem: Context Dilution</div>
          <p class="state-problem-text">In long sessions, early decisions fade from context window. By implementation time, the AI has "forgotten" what you agreed on 30 turns ago.</p>

          <div class="state-solution-label"><i class="fa-solid fa-check-circle"></i> Solution: Periodic Re-grounding</div>
          <p>Every <strong>7 turns</strong>, <code>periodic-reground.py</code> injects a context reminder:</p>

          <div class="state-code" style="font-size: 0.75rem; padding: 15px; margin-top: 10px; line-height: 1.5;">
<pre><span class="dim">CONTEXT REMINDER:</span>
<span class="key">Current phase:</span> <span class="string">tdd_green</span>
<span class="key">Interview decisions:</span>
  <span class="string">- format: svg and png</span>
  <span class="string">- caching: 24 hours</span>
  <span class="string">- error_handling: error_objects</span>
<span class="key">Turn count:</span> <span class="number">23</span></pre>
          </div>

          <p class="state-why"><strong>Why it matters:</strong> Your decisions are actively re-injected into context. Claude never "forgets" what you agreed on, even in 50+ turn sessions.</p>
        </div>
      </div>

      <!-- JSON state + field explanations - SECOND -->
      <div class="state-container">
        <div class="state-code">
<pre>{
  <span class="key">"endpoint"</span>: <span class="string">"brandfetch"</span>,
  <span class="key">"current_phase"</span>: <span class="string">"tdd_green"</span>,
  <span class="key">"phases"</span>: {
    <span class="key">"research_initial"</span>: {
      <span class="key">"status"</span>: <span class="string">"complete"</span>,
      <span class="key">"sources"</span>: [<span class="string">"Context7"</span>, <span class="string">"WebSearch"</span>],
      <span class="key">"phase_exit_confirmed"</span>: <span class="boolean">true</span>
    },
    <span class="key">"interview"</span>: {
      <span class="key">"status"</span>: <span class="string">"complete"</span>,
      <span class="key">"phase_exit_confirmed"</span>: <span class="boolean">true</span>,
      <span class="key">"decisions"</span>: [
        <span class="string">"format: both svg and png"</span>,
        <span class="string">"caching: 24 hours"</span>,
        <span class="string">"error_handling: error_objects"</span>
      ]
    }
  },
  <span class="key">"files_created"</span>: [
    <span class="string">"src/app/api/v2/brandfetch/route.ts"</span>,
    <span class="string">"src/app/api/v2/brandfetch/__tests__/"</span>
  ],
  <span class="key">"turn_count"</span>: <span class="number">23</span>,
  <span class="key">"last_reground"</span>: <span class="number">21</span>
}</pre>
        </div>

        <div class="state-explanation">
          <div class="state-field">
            <h4><i class="fa-solid fa-database"></i> phases.*</h4>
            <p>Tracks completion status for all 12 phases. Hooks check this before allowing operations.</p>
          </div>

          <div class="state-field">
            <h4><i class="fa-solid fa-list-check"></i> interview.decisions[]</h4>
            <p>User choices injected into every Write operation to prevent context dilution.</p>
          </div>

          <div class="state-field">
            <h4><i class="fa-solid fa-clock-rotate-left"></i> turn_count / last_reground</h4>
            <p>Every 7 turns, context is re-injected via periodic-reground.py hook.</p>
          </div>

          <div class="state-field">
            <h4><i class="fa-solid fa-folder-open"></i> files_created / files_modified</h4>
            <p>Tracked files compared against git diff at completion to verify claims.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 8: Get Started (Combined with Built for Claude Code) -->
  <section id="install">
    <div class="section-inner">
      <div class="section-header">
        <h2>Get Started</h2>
        <p class="text-muted">Built specifically for Claude Code. Install in under 60 seconds.</p>
      </div>

      <div class="install-command">
        <span class="prompt">$ </span><span class="cmd">npx @hustle-together/api-dev-tools</span>
      </div>

      <p style="text-align: center; color: var(--text-muted); margin-bottom: 50px;">
        Automatically installs <strong>18 enforcement hooks</strong>, <strong>24 slash commands</strong>, and <strong>templates</strong> into your <code>.claude/</code> directory.
        <br>Works with any existing Claude Code project.
      </p>

      <!-- Why Claude Code -->
      <div class="claude-features">
        <div class="claude-feature">
          <h4><i class="fa-solid fa-plug"></i> MCP Integration</h4>
          <p>Works with <strong>Context7</strong> for library documentation and <strong>GitHub MCP</strong> for issue tracking. Research is always current.</p>
        </div>
        <div class="claude-feature">
          <h4><i class="fa-solid fa-code"></i> Exit Code 2</h4>
          <p>Hooks use Claude Code's exit code 2 to create <strong>blocking feedback loops</strong>. Claude MUST respond to errors - it cannot ignore them.</p>
        </div>
        <div class="claude-feature">
          <h4><i class="fa-solid fa-folder-tree"></i> .claude/ Directory</h4>
          <p>Everything lives in your project's <code>.claude/</code> folder. Commands, hooks, state, and research cache - all version controlled.</p>
        </div>
      </div>

      <div class="install-links">
        <a href="https://github.com/hustle-together/api-dev-tools" class="btn">
          <i class="fa-brands fa-github"></i> GitHub
        </a>
        <a href="https://www.npmjs.com/package/@hustle-together/api-dev-tools" class="btn">
          <i class="fa-brands fa-npm"></i> npm
        </a>
        <a href="https://github.com/hustle-together/api-dev-tools#readme" class="btn primary">
          <i class="fa-solid fa-book"></i> Documentation
        </a>
      </div>

      <div class="credits-attribution">
        <p><i class="fa-solid fa-code-branch"></i> TDD commands adapted from <a href="https://github.com/wbern/claude-instructions">@wbern/claude-instructions</a></p>
        <p><i class="fa-solid fa-magnifying-glass"></i> Research powered by <a href="https://context7.com">Context7 MCP</a></p>
        <p class="hustle-footer">
          <span>Made by</span> <a href="https://hustle-together.com"><span class="hustle-brand">Hustle Together</span></a>
        </p>
      </div>
    </div>
  </section>

  <script>
    // ============================================
    // GSAP ANIMATIONS
    // ============================================

    gsap.registerPlugin(ScrollTrigger, TextPlugin);

    // Create floating shapes
    function createFloatingShapes() {
      const container = document.getElementById('floating-shapes');
      const shapes = ['square', 'square-filled', 'line-h', 'line-v', 'plus', 'circle', 'dot'];
      const count = 30;

      for (let i = 0; i < count; i++) {
        const shape = document.createElement('div');
        shape.className = `floating-shape ${shapes[Math.floor(Math.random() * shapes.length)]}`;
        shape.style.left = `${Math.random() * 100}%`;
        shape.style.top = `${Math.random() * 100}%`;

        const duration = 15 + Math.random() * 20;
        const delay = Math.random() * -20;
        const animations = ['float', 'float-reverse', 'drift'];
        shape.style.animation = `${animations[Math.floor(Math.random() * animations.length)]} ${duration}s ease-in-out ${delay}s infinite`;

        container.appendChild(shape);
      }
    }
    createFloatingShapes();

    // Hero animations
    const heroTl = gsap.timeline({ delay: 0.5 });

    heroTl.to('.hero-badge', {
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: 'power2.out'
    })
    .to('.hero-title', {
      opacity: 1,
      y: 0,
      duration: 0.8,
      ease: 'power2.out'
    }, '-=0.3')
    .to('.hero-tagline', {
      opacity: 1,
      duration: 0.6,
      ease: 'power2.out'
    }, '-=0.4')
    .to('.hero-terminal', {
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: 'power2.out'
    }, '-=0.3')
    .to('#hero-command', {
      text: 'npx @hustle-together/api-dev-tools',
      duration: 1.5,
      ease: 'none'
    }, '-=0.2')
    .to('.hero-buttons', {
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: 'power2.out'
    }, '-=0.8')
    .to('.scroll-indicator', {
      opacity: 1,
      duration: 0.6
    }, '-=0.3');

    // Problem cards animation
    gsap.utils.toArray('.problem-card').forEach((card, i) => {
      gsap.to(card, {
        scrollTrigger: {
          trigger: card,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.6,
        delay: i * 0.1,
        ease: 'power2.out'
      });
    });

    // Solution stats animation
    gsap.utils.toArray('.stat').forEach((stat, i) => {
      gsap.to(stat, {
        scrollTrigger: {
          trigger: stat,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.6,
        delay: i * 0.15,
        ease: 'power2.out'
      });
    });

    // Solution cards animation
    gsap.utils.toArray('.solution-card').forEach((card, i) => {
      gsap.to(card, {
        scrollTrigger: {
          trigger: card,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.6,
        delay: i * 0.1,
        ease: 'power2.out'
      });
    });

    // Grounding tools animation
    gsap.utils.toArray('.grounding-tool').forEach((tool, i) => {
      gsap.to(tool, {
        scrollTrigger: {
          trigger: tool,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.6,
        delay: i * 0.15,
        ease: 'power2.out'
      });
    });

    // Grounding enforcement animation
    gsap.to('.grounding-enforcement', {
      scrollTrigger: {
        trigger: '.grounding-enforcement',
        start: 'top 85%',
        toggleActions: 'play none none reverse'
      },
      opacity: 1,
      y: 0,
      duration: 0.7,
      ease: 'power2.out'
    });

    // Hook types animation
    gsap.utils.toArray('.hook-type').forEach((hook, i) => {
      gsap.to(hook, {
        scrollTrigger: {
          trigger: hook,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.6,
        delay: i * 0.1,
        ease: 'power2.out'
      });
    });

    // Exit code demo animation
    gsap.to('.exit-code-demo', {
      scrollTrigger: {
        trigger: '.exit-code-demo',
        start: 'top 85%',
        toggleActions: 'play none none reverse'
      },
      opacity: 1,
      y: 0,
      duration: 0.8,
      ease: 'power2.out'
    });

    // Exit code callout animation
    gsap.to('.exit-code-callout', {
      scrollTrigger: {
        trigger: '.exit-code-callout',
        start: 'top 85%',
        toggleActions: 'play none none reverse'
      },
      opacity: 1,
      y: 0,
      duration: 0.7,
      ease: 'power2.out'
    });

    // Phase cards animation
    gsap.utils.toArray('.phase-card').forEach((card, i) => {
      gsap.to(card, {
        scrollTrigger: {
          trigger: card,
          start: 'top 90%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.5,
        delay: (i % 2) * 0.1,
        ease: 'power2.out'
      });
    });

    // Demo container animation
    gsap.to('.demo-container', {
      scrollTrigger: {
        trigger: '.demo-container',
        start: 'top 80%',
        toggleActions: 'play none none reverse'
      },
      opacity: 1,
      duration: 0.8,
      ease: 'power2.out'
    });

    // State container animation
    gsap.to('.state-container', {
      scrollTrigger: {
        trigger: '.state-container',
        start: 'top 80%',
        toggleActions: 'play none none reverse'
      },
      opacity: 1,
      duration: 0.8,
      ease: 'power2.out'
    });

    // State fields animation
    gsap.utils.toArray('.state-field').forEach((field, i) => {
      gsap.to(field, {
        scrollTrigger: {
          trigger: field,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        x: 0,
        duration: 0.5,
        delay: i * 0.1,
        ease: 'power2.out'
      });
    });

    // Install command animation
    gsap.to('.install-command', {
      scrollTrigger: {
        trigger: '.install-command',
        start: 'top 85%',
        toggleActions: 'play none none reverse'
      },
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: 'power2.out'
    });

    // Install features animation
    gsap.utils.toArray('.install-feature').forEach((feature, i) => {
      gsap.to(feature, {
        scrollTrigger: {
          trigger: feature,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.5,
        delay: i * 0.1,
        ease: 'power2.out'
      });
    });

    // Claude features animation
    gsap.utils.toArray('.claude-feature').forEach((feature, i) => {
      gsap.to(feature, {
        scrollTrigger: {
          trigger: feature,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 0.5,
        delay: i * 0.1,
        ease: 'power2.out'
      });
    });

    // ============================================
    // EXPAND/COLLAPSE FUNCTIONALITY
    // ============================================

    function toggleExpand(btn) {
      const card = btn.closest('.phase-card');
      const details = card.querySelector('.phase-details');

      btn.classList.toggle('expanded');
      details.classList.toggle('expanded');

      if (details.classList.contains('expanded')) {
        btn.innerHTML = '<span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> COLLAPSE';
      } else {
        btn.innerHTML = '<span class="arrow"><i class="fa-solid fa-chevron-down"></i></span> EXPAND DETAILS';
      }
    }

    // ============================================
    // TERMINAL DEMO - Scene-based system (All 12 phases)
    // ============================================

    const demoScenes = [
      // SCENE 1: DISAMBIGUATION (Phase 0)
      {
        id: 1,
        phase: 0,
        title: 'Phase 0: Disambiguation',
        problem: 'Claude might research the wrong library. "Brandfetch" could mean the REST API, npm SDK, or custom code.',
        solution: 'The enforce-disambiguation hook blocks ALL research until Claude asks you to clarify. You pick from numbered options.',
        hook: 'enforce-disambiguation.py',
        lines: [
          { text: '$ /api-create brandfetch', class: 'user' },
          { text: '', class: 'output' },
          { text: 'Starting API workflow for "brandfetch"...', class: 'ai' },
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 0: DISAMBIGUATION                                      â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'Claude: The term "brandfetch" could refer to:', class: 'ai' },
          { text: '  [1] Brandfetch API (brand.dev) - REST API for brand assets', class: 'output' },
          { text: '  [2] @brandfetch/sdk - Official npm SDK', class: 'output' },
          { text: '  [3] Custom brand fetching logic', class: 'output' },
          { text: '', class: 'output' },
          { text: 'Which do you mean?', class: 'ai' },
          { text: 'User: 1', class: 'user' },
          { text: 'âœ“ Disambiguation complete: Brandfetch REST API', class: 'success' }
        ]
      },
      // SCENE 2: ERROR DEMO - Exit Code 2 Enforcement (shown early!)
      {
        id: 2,
        phase: -1,
        title: 'Exit Code 2: Enforcement',
        problem: 'Claude wants to skip research and start coding. It thinks it "already knows" the API from training data.',
        solution: 'Exit code 2 creates a HARD BLOCK. Claude cannot proceed or ignore it. It MUST respond to the error and complete research.',
        hook: 'enforce-research.py (exit code 2)',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'warning' },
          { text: 'â•‘  ENFORCEMENT DEMO: What if Claude skips research?             â•‘', class: 'warning' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'warning' },
          { text: '', class: 'output' },
          { text: 'â†’ Write: src/app/api/v2/brandfetch/route.ts', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', class: 'hook-block' },
          { text: 'â”‚  âŒ BLOCKED by enforce-research.py (exit code 2)            â”‚', class: 'hook-block' },
          { text: 'â”‚                                                              â”‚', class: 'hook-block' },
          { text: 'â”‚  RESEARCH PHASE INCOMPLETE                                   â”‚', class: 'hook-block' },
          { text: 'â”‚  Sources consulted: 0 (minimum: 2)                           â”‚', class: 'hook-block' },
          { text: 'â”‚                                                              â”‚', class: 'hook-block' },
          { text: 'â”‚  REQUIRED: Use Context7 or WebSearch first                   â”‚', class: 'hook-block' },
          { text: 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', class: 'hook-block' },
          { text: '', class: 'output' },
          { text: 'Exit code 2 = Claude MUST respond. Cannot proceed.', class: 'warning' },
          { text: '(Continuing with proper workflow...)', class: 'ai' }
        ]
      },
      // SCENE 3: SCOPE CONFIRMATION (Phase 1)
      {
        id: 3,
        phase: 1,
        title: 'Phase 1: Scope Confirmation',
        problem: 'Claude might misunderstand what you want. You say "fetch brand assets" but Claude thinks you want a database model.',
        solution: 'Before research, Claude summarizes its understanding and asks "Is this correct?" You confirm or correct before any work begins.',
        hook: 'enforce-scope.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 1: SCOPE CONFIRMATION                                  â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'Claude: Let me confirm the scope:', class: 'ai' },
          { text: '  Purpose: Fetch brand assets by domain', class: 'output' },
          { text: '  Input:   Domain name (e.g., "github.com")', class: 'output' },
          { text: '  Output:  Brand data (logos, colors, fonts)', class: 'output' },
          { text: '', class: 'output' },
          { text: 'Is this correct? [Y/n]', class: 'ai' },
          { text: 'User: Y', class: 'user' },
          { text: 'âœ“ Scope confirmed. Proceeding to research.', class: 'success' }
        ]
      },
      // SCENE 4: INITIAL RESEARCH (Phase 2) - Context7 MCP
      {
        id: 4,
        phase: 2,
        title: 'Phase 2: Initial Research',
        problem: 'Claude\'s training data might be months or years old. APIs change, endpoints get deprecated, auth methods evolve.',
        solution: 'Claude must fetch CURRENT docs via Context7 MCP or WebSearch. Two sources minimum. Cross-referenced for accuracy.',
        hook: 'enforce-research.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 2: INITIAL RESEARCH                                    â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'Claude: Fetching current documentation via MCP...', class: 'ai' },
          { text: '', class: 'output' },
          { text: 'â†’ mcp__context7__resolve-library-id', class: 'mcp-call' },
          { text: '  libraryName: "brandfetch"', class: 'dim' },
          { text: '  âœ“ Found: /brandfetch/brandfetch-api', class: 'success' },
          { text: '', class: 'output' },
          { text: 'â†’ mcp__context7__get-library-docs', class: 'mcp-call' },
          { text: '  âœ“ Retrieved 23 endpoints, 47 parameters', class: 'success' },
          { text: '', class: 'output' },
          { text: 'â†’ WebSearch: "Brandfetch API authentication 2024"', class: 'mcp-call' },
          { text: '  âœ“ Found: Bearer token auth required', class: 'success' },
          { text: '', class: 'output' },
          { text: 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', class: 'output' },
          { text: 'â”‚ Research Summary                                    â”‚', class: 'output' },
          { text: 'â”‚ Base URL: api.brandfetch.io/v2                      â”‚', class: 'output' },
          { text: 'â”‚ Auth: Bearer token, Formats: svg|png|jpg            â”‚', class: 'output' },
          { text: 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', class: 'output' },
          { text: 'âœ“ Research complete (2 sources).', class: 'success' }
        ]
      },
      // SCENE 5: INTERVIEW (Phase 3)
      {
        id: 5,
        phase: 3,
        title: 'Phase 3: Structured Interview',
        problem: 'Generic AI asks template questions without knowing what options exist. Or worse, it asks then immediately answers itself.',
        solution: 'Questions come FROM research findings. Numbered options only. Self-answering blocked. Your decisions are locked in.',
        hook: 'enforce-interview.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 3: STRUCTURED INTERVIEW                                â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'Q1: Logo formats? (discovered: svg|png|jpg)', class: 'output' },
          { text: '  [1] SVG only  [2] PNG only  [3] Both  [4] All', class: 'output' },
          { text: 'User: 3', class: 'user' },
          { text: 'âœ“ Decision: format = svg,png', class: 'success' },
          { text: '', class: 'output' },
          { text: 'Q2: Cache duration?', class: 'output' },
          { text: '  [1] None  [2] 1h  [3] 24h (recommended)  [4] 7d', class: 'output' },
          { text: 'User: 3', class: 'user' },
          { text: 'âœ“ Decision: cache_ttl = 24h', class: 'success' },
          { text: '', class: 'output' },
          { text: 'âœ“ Interview complete. phase_exit_confirmed: true', class: 'success' }
        ]
      },
      // SCENE 6: DEEP RESEARCH (Phase 4)
      {
        id: 6,
        phase: 4,
        title: 'Phase 4: Deep Research',
        problem: 'Initial research gives the overview, but your specific choices might need deeper investigation.',
        solution: 'Based on YOUR interview answers, Claude proposes targeted follow-up searches. Your requirements drive the investigation.',
        hook: 'enforce-deep-research.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 4: DEEP RESEARCH                                       â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'Claude: Researching specific areas from your choices...', class: 'ai' },
          { text: '', class: 'output' },
          { text: 'â†’ WebSearch: "Brandfetch SVG PNG format parameter"', class: 'mcp-call' },
          { text: '  âœ“ Found: format query param accepts comma-separated', class: 'success' },
          { text: '', class: 'output' },
          { text: 'â†’ WebSearch: "Brandfetch cache headers CDN"', class: 'mcp-call' },
          { text: '  âœ“ Found: Supports Cache-Control, ETag headers', class: 'success' },
          { text: '', class: 'output' },
          { text: 'âœ“ Deep research complete.', class: 'success' }
        ]
      },
      // SCENE 7: SCHEMA CREATION (Phase 5)
      {
        id: 7,
        phase: 5,
        title: 'Phase 5: Schema Creation',
        problem: 'Without a contract, tests and implementation drift apart. Fields aren\'t validated or typed correctly.',
        solution: 'Zod schemas define exact request/response shapes. Every discovered parameter typed. Becomes the source of truth.',
        hook: 'enforce-schema.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 5: SCHEMA CREATION                                     â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ Write: src/lib/schemas/brandfetch.ts', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: '  BrandfetchRequestSchema: { domain, format }', class: 'dim' },
          { text: '  BrandfetchResponseSchema: { logos[], colors[] }', class: 'dim' },
          { text: '', class: 'output' },
          { text: 'âœ“ Schemas created with full type coverage.', class: 'success' }
        ]
      },
      // SCENE 8: ENVIRONMENT CHECK (Phase 6)
      {
        id: 8,
        phase: 6,
        title: 'Phase 6: Environment Check',
        problem: 'Tests pass locally but fail in CI. Why? Missing API key. You waste 30 minutes debugging.',
        solution: 'Check environment BEFORE writing tests. Is the API key present? Is the format valid? No surprises later.',
        hook: 'enforce-environment.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 6: ENVIRONMENT CHECK                                   â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: '  BRANDFETCH_API_KEY: âœ“ present (.env.local)', class: 'success' },
          { text: '  API key format: âœ“ valid', class: 'success' },
          { text: '', class: 'output' },
          { text: 'âœ“ Environment ready for testing.', class: 'success' }
        ]
      },
      // SCENE 9: TDD RED (Phase 7)
      {
        id: 9,
        phase: 7,
        title: 'Phase 7: TDD Red',
        problem: 'Without tests, you don\'t know if code works. You ship bugs. You break things in production.',
        solution: 'Write failing tests FIRST. Define success before implementation. Tests cover research findings AND interview decisions.',
        hook: 'enforce-tdd-red.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 7: TDD RED - Write Failing Tests                       â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ Write: brandfetch/__tests__/brandfetch.test.ts', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: '$ pnpm test:run brandfetch', class: 'user' },
          { text: ' FAIL  brandfetch.test.ts', class: 'error' },
          { text: '  âœ— returns brand data for valid domain', class: 'error' },
          { text: '  âœ— returns SVG and PNG formats (interview)', class: 'error' },
          { text: '  âœ— respects 24h cache (interview)', class: 'error' },
          { text: '  âœ— returns 401 without API key', class: 'error' },
          { text: ' Tests: 4 failed, 0 passed', class: 'error' },
          { text: '', class: 'output' },
          { text: 'âœ“ Red phase complete. Tests failing.', class: 'success' }
        ]
      },
      // SCENE 10: TDD GREEN (Phase 8)
      {
        id: 10,
        phase: 8,
        title: 'Phase 8: TDD Green',
        problem: 'Developers write more code than needed. They add features not requested. They over-engineer.',
        solution: 'Write MINIMAL implementation. Just enough to pass tests. When tests pass, verification triggers automatically.',
        hook: 'verify-after-green.py (PostToolUse)',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 8: TDD GREEN - Make Tests Pass                         â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ Write: src/app/api/v2/brandfetch/route.ts', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: '$ pnpm test:run brandfetch', class: 'user' },
          { text: ' PASS  brandfetch.test.ts', class: 'success' },
          { text: '  âœ“ returns brand data for valid domain', class: 'success' },
          { text: '  âœ“ returns SVG and PNG formats', class: 'success' },
          { text: '  âœ“ respects 24h cache', class: 'success' },
          { text: '  âœ“ returns 401 without API key', class: 'success' },
          { text: ' Tests: 4 passed', class: 'success' },
          { text: '', class: 'output' },
          { text: 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', class: 'warning' },
          { text: 'â”‚  âš¡ HOOK TRIGGERED: verify-after-green.py                    â”‚', class: 'warning' },
          { text: 'â”‚  Tests passed â†’ Auto-triggering verification                 â”‚', class: 'warning' },
          { text: 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', class: 'warning' }
        ]
      },
      // SCENE 11: VERIFICATION (Phase 9)
      {
        id: 11,
        phase: 9,
        title: 'Phase 9: Verification',
        problem: 'Even after researching, Claude might implement from memory. It forgets details. Implementation drifts from docs.',
        solution: 'After tests pass, RE-FETCH docs. Compare implementation to current docs. If mismatch, loop back to Red phase.',
        hook: 'verify-after-green.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 9: VERIFY - Re-Research & Compare                      â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ mcp__context7__get-library-docs (re-fetch)', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', class: 'output' },
          { text: 'â”‚ Feature         â”‚ Docs         â”‚ Implementationâ”‚', class: 'output' },
          { text: 'â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤', class: 'output' },
          { text: 'â”‚ Auth method     â”‚ Bearer token â”‚ âœ“ Match      â”‚', class: 'success' },
          { text: 'â”‚ Logo formats    â”‚ svg,png,jpg  â”‚ âœ“ Match      â”‚', class: 'success' },
          { text: 'â”‚ Cache header    â”‚ Cache-Controlâ”‚ âœ“ 24h        â”‚', class: 'success' },
          { text: 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', class: 'output' },
          { text: 'âœ“ Implementation matches docs.', class: 'success' }
        ]
      },
      // SCENE 12: TDD REFACTOR (Phase 10)
      {
        id: 12,
        phase: 10,
        title: 'Phase 10: TDD Refactor',
        problem: 'First implementations are often messy. But cleaning up code might break things without you knowing.',
        solution: 'Refactor WHILE tests stay green. Every change verified by existing test suite. If anything breaks, you know immediately.',
        hook: 'enforce-refactor.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 10: TDD REFACTOR - Clean Up Code                       â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ Edit: Extract fetchBrandData helper', class: 'mcp-call' },
          { text: 'â†’ Edit: Add JSDoc comments', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: '$ pnpm test:run brandfetch', class: 'user' },
          { text: ' PASS  Tests: 4 passed', class: 'success' },
          { text: 'âœ“ Refactor complete. Tests still passing.', class: 'success' }
        ]
      },
      // SCENE 13: DOCUMENTATION (Phase 11)
      {
        id: 13,
        phase: 11,
        title: 'Phase 11: Documentation',
        problem: 'Knowledge gets lost. The next developer starts from scratch. They make the same mistakes, ask the same questions.',
        solution: 'Cache everything. Research cached with 7-day freshness. API manifest updated. Future sessions benefit from today\'s work.',
        hook: 'enforce-documentation.py',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 11: DOCUMENTATION                                      â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ Write: .claude/research/brandfetch/CURRENT.md', class: 'mcp-call' },
          { text: 'â†’ Edit: api-tests-manifest.json', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: 'âœ“ Research cached (7-day freshness)', class: 'success' },
          { text: 'âœ“ API manifest updated', class: 'success' }
        ]
      },
      // SCENE 14: COMPLETION (Phase 12)
      {
        id: 14,
        phase: 12,
        title: 'Phase 12: Completion',
        problem: 'How do you know everything is actually done? Claude might claim finished but skip steps.',
        solution: 'The api-workflow-check hook runs at stop time. Verifies all 12 phases completed. All files created, tests passing, docs updated.',
        hook: 'api-workflow-check.py (Stop)',
        lines: [
          { text: '', class: 'output' },
          { text: 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', class: 'highlight' },
          { text: 'â•‘  PHASE 12: COMPLETION                                         â•‘', class: 'highlight' },
          { text: 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'highlight' },
          { text: '', class: 'output' },
          { text: 'â†’ api-workflow-check.py verifying all 12 phases...', class: 'mcp-call' },
          { text: '', class: 'output' },
          { text: '  âœ“ disambiguation: complete', class: 'success' },
          { text: '  âœ“ scope: complete', class: 'success' },
          { text: '  âœ“ research_initial: complete', class: 'success' },
          { text: '  âœ“ interview: complete', class: 'success' },
          { text: '  âœ“ research_deep: complete', class: 'success' },
          { text: '  âœ“ schema_creation: complete', class: 'success' },
          { text: '  âœ“ environment: complete', class: 'success' },
          { text: '  âœ“ tdd_red: complete', class: 'success' },
          { text: '  âœ“ tdd_green: complete', class: 'success' },
          { text: '  âœ“ verification: complete', class: 'success' },
          { text: '  âœ“ tdd_refactor: complete', class: 'success' },
          { text: '  âœ“ documentation: complete', class: 'success' },
          { text: '', class: 'output' },
          { text: 'Files created: route.ts, brandfetch.test.ts, schema.ts', class: 'output' },
          { text: '', class: 'output' },
          { text: 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'success' },
          { text: '  âœ“ WORKFLOW COMPLETE - All 12 phases verified                  ', class: 'success' },
          { text: 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', class: 'success' }
        ]
      }
    ];

    let currentScene = 0;
    let currentLine = 0;
    let demoPlaying = false;
    let demoTimeout = null;
    let playSpeed = 1;

    function updatePhaseList(phase) {
      const items = document.querySelectorAll('.phase-list li');
      items.forEach(item => {
        const itemPhase = parseInt(item.dataset.phase);
        item.classList.remove('active', 'complete');
        if (phase >= 0) {
          if (itemPhase < phase) {
            item.classList.add('complete');
          } else if (itemPhase === phase) {
            item.classList.add('active');
            // Scroll the active item into view
            item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }
        }
      });

      // Update phase number display
      const phaseNum = phase >= 0 ? phase : '?';
      document.getElementById('phase-number').textContent = `${phaseNum}/12`;

      // Update progress bar
      const progress = phase >= 0 ? (phase / 12) * 100 : 0;
      document.getElementById('progress-fill').style.width = `${progress}%`;
    }

    function updateExplanation(scene) {
      document.getElementById('demo-explanation-title').textContent = scene.title;

      // Build problem/solution format
      const textEl = document.getElementById('demo-explanation-text');
      if (scene.problem && scene.solution) {
        textEl.innerHTML = `
          <div class="explanation-problem">
            <strong>The Problem:</strong> ${scene.problem}
          </div>
          <div class="explanation-solution">
            <strong>The Solution:</strong> ${scene.solution}
          </div>
        `;
      } else if (scene.explanation) {
        // Fallback for any scenes without problem/solution
        textEl.textContent = scene.explanation;
      }

      const hookBadge = document.getElementById('demo-hook-badge');
      if (scene.hook) {
        hookBadge.textContent = scene.hook;
        hookBadge.style.display = 'block';
      } else {
        hookBadge.style.display = 'none';
      }
    }

    function updateSceneIndicator() {
      document.getElementById('demo-scene-indicator').textContent = `Scene ${currentScene + 1} of ${demoScenes.length}`;
    }

    function updateButtonStates() {
      document.getElementById('demo-prev').disabled = currentScene === 0 && currentLine === 0;
      document.getElementById('demo-next').disabled = currentScene >= demoScenes.length - 1 &&
        currentLine >= demoScenes[currentScene].lines.length;

      const playBtn = document.getElementById('demo-play');
      if (demoPlaying) {
        playBtn.innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
        playBtn.classList.add('active');
      } else {
        playBtn.innerHTML = '<i class="fa-solid fa-play"></i> Auto-play';
        playBtn.classList.remove('active');
      }
    }

    function addLine(lineData) {
      const content = document.getElementById('demo-content');
      const lineEl = document.createElement('div');
      lineEl.className = `line ${lineData.class}`;
      lineEl.textContent = lineData.text;
      content.appendChild(lineEl);

      gsap.to(lineEl, {
        opacity: 1,
        y: 0,
        duration: 0.2
      });

      content.scrollTop = content.scrollHeight;
    }

    function showScene(sceneIndex, fromLine = 0) {
      if (sceneIndex < 0 || sceneIndex >= demoScenes.length) return;

      currentScene = sceneIndex;
      currentLine = fromLine;

      const scene = demoScenes[sceneIndex];

      // Clear terminal if starting fresh scene
      if (fromLine === 0) {
        document.getElementById('demo-content').innerHTML = '';
      }

      // Show all lines up to fromLine
      for (let i = 0; i < fromLine; i++) {
        addLine(scene.lines[i]);
      }

      updatePhaseList(scene.phase);
      updateExplanation(scene);
      updateSceneIndicator();
      updateButtonStates();
    }

    function nextLine() {
      const scene = demoScenes[currentScene];

      if (currentLine < scene.lines.length) {
        addLine(scene.lines[currentLine]);
        currentLine++;
        updateButtonStates();
        return true;
      } else if (currentScene < demoScenes.length - 1) {
        // Move to next scene
        currentScene++;
        currentLine = 0;
        const nextScene = demoScenes[currentScene];
        updatePhaseList(nextScene.phase);
        updateExplanation(nextScene);
        updateSceneIndicator();

        // Add first line of new scene
        addLine(nextScene.lines[0]);
        currentLine = 1;
        updateButtonStates();
        return true;
      }

      return false; // No more lines
    }

    function prevScene() {
      if (currentScene > 0) {
        currentScene--;
        showScene(currentScene, 0);

        // Show all lines of previous scene
        const scene = demoScenes[currentScene];
        for (let i = 0; i < scene.lines.length; i++) {
          addLine(scene.lines[i]);
        }
        currentLine = scene.lines.length;
      } else {
        resetDemo();
      }
      updateButtonStates();
    }

    function nextStep() {
      if (demoPlaying) {
        stopAutoplay();
      }
      nextLine();
    }

    function prevStep() {
      if (demoPlaying) {
        stopAutoplay();
      }
      prevScene();
    }

    // Pause at end of each scene to let user read and let narration catch up
    let pauseAtSceneEnd = true;

    function autoplayTick() {
      if (!demoPlaying) return;

      const scene = demoScenes[currentScene];
      const atSceneEnd = currentLine >= scene.lines.length;

      // If at end of scene and pause is enabled, wait for user to tap Next
      if (atSceneEnd && pauseAtSceneEnd && currentScene < demoScenes.length - 1) {
        stopAutoplay();
        // Show hint to continue
        const playBtn = document.getElementById('demo-play');
        playBtn.innerHTML = '<i class="fa-solid fa-forward-step"></i> Next Scene';
        playBtn.classList.add('pulse-hint');
        return;
      }

      const hasMore = nextLine();
      if (hasMore) {
        const line = scene.lines[currentLine - 1];
        // Much slower delays for better readability
        let delay = 400 / playSpeed;  // Base delay increased from 150ms to 400ms

        if (line.text === '') delay = 200 / playSpeed;  // Empty lines
        else if (line.class === 'user') delay = 1200 / playSpeed;  // User input - pause longer
        else if (line.class === 'highlight') delay = 800 / playSpeed;  // Headers
        else if (line.class === 'success') delay = 600 / playSpeed;  // Success messages
        else if (line.class === 'hook-block') delay = 500 / playSpeed;  // Hook blocks
        else if (line.class === 'warning') delay = 700 / playSpeed;  // Warnings
        else if (line.class === 'mcp-call') delay = 500 / playSpeed;  // MCP calls

        demoTimeout = setTimeout(autoplayTick, delay);
      } else {
        stopAutoplay();
      }
    }

    function startAutoplay() {
      demoPlaying = true;
      // Remove pulse hint if present
      const playBtn = document.getElementById('demo-play');
      playBtn.classList.remove('pulse-hint');

      // Ensure explanation panel is updated for current scene
      const scene = demoScenes[currentScene];
      if (scene) {
        updatePhaseList(scene.phase);
        updateExplanation(scene);
      }

      updateButtonStates();
      autoplayTick();
    }

    function stopAutoplay() {
      demoPlaying = false;
      if (demoTimeout) {
        clearTimeout(demoTimeout);
        demoTimeout = null;
      }
      updateButtonStates();
    }

    function toggleAutoplay() {
      if (demoPlaying) {
        stopAutoplay();
      } else {
        startAutoplay();
      }
    }

    function resetDemo() {
      stopAutoplay();
      currentScene = 0;
      currentLine = 0;
      document.getElementById('demo-content').innerHTML = '';
      document.getElementById('demo-explanation-title').textContent = 'Ready to Start';
      document.getElementById('demo-explanation-text').textContent = 'Click Auto-play to watch the full workflow, or use Next/Prev to step through manually.';
      document.getElementById('demo-hook-badge').style.display = 'none';
      updatePhaseList(-1);
      updateSceneIndicator();
      updateButtonStates();
    }

    function skipToErrorDemo() {
      stopAutoplay();
      // Find the error demo scene (last one)
      const errorSceneIndex = demoScenes.findIndex(s => s.phase === -1);
      if (errorSceneIndex >= 0) {
        showScene(errorSceneIndex, 0);
        // Show all lines
        const scene = demoScenes[errorSceneIndex];
        for (let i = 0; i < scene.lines.length; i++) {
          addLine(scene.lines[i]);
        }
        currentLine = scene.lines.length;
        updateButtonStates();
      }
    }

    // Jump to a specific phase - shows all content up to and including that phase
    function jumpToPhase(targetPhase) {
      stopAutoplay();

      // Clear terminal
      document.getElementById('demo-content').innerHTML = '';

      // Find all scenes up to and including this phase
      let targetSceneIndex = -1;
      for (let i = 0; i < demoScenes.length; i++) {
        const scene = demoScenes[i];

        // Skip scenes until we find one at or after the target phase
        if (scene.phase <= targetPhase) {
          // Show all lines from this scene
          for (const line of scene.lines) {
            addLine(line);
          }
          targetSceneIndex = i;
        }

        // Stop when we've shown the target phase
        if (scene.phase === targetPhase) {
          break;
        }
      }

      // Set current scene to the target
      if (targetSceneIndex >= 0) {
        currentScene = targetSceneIndex;
        const scene = demoScenes[targetSceneIndex];
        currentLine = scene.lines.length;

        updatePhaseList(scene.phase);
        updateExplanation(scene);
        updateSceneIndicator();
        updateButtonStates();

        // Sync audio if enabled
        if (typeof demoAudioController !== 'undefined' && demoAudioController.enabled) {
          demoAudioController.playPhaseAudio(targetPhase);
        }
      }
    }

    // Event listeners
    document.getElementById('demo-play').addEventListener('click', toggleAutoplay);
    document.getElementById('demo-reset').addEventListener('click', resetDemo);
    document.getElementById('demo-next').addEventListener('click', nextStep);
    document.getElementById('demo-prev').addEventListener('click', prevStep);
    document.getElementById('demo-skip-error').addEventListener('click', skipToErrorDemo);
    document.getElementById('demo-speed').addEventListener('change', (e) => {
      playSpeed = parseFloat(e.target.value);
    });

    // Initialize
    updateSceneIndicator();
    updateButtonStates();

    // ============================================
    // DEMO AUDIO CONTROLLER
    // Uses individual audio clips per phase for instant playback
    // ============================================
    const demoAudioController = {
      audio: null,
      enabled: false,
      isPlaying: false,
      currentPhase: null,

      // Map of phase numbers to audio files
      audioFiles: {
        intro: 'audio/demo-intro.mp3',
        0: 'audio/demo-phase-0.mp3',
        1: 'audio/demo-phase-1.mp3',
        2: 'audio/demo-phase-2.mp3',
        3: 'audio/demo-phase-3.mp3',
        4: 'audio/demo-phase-4.mp3',
        5: 'audio/demo-phase-5.mp3',
        6: 'audio/demo-phase-6.mp3',
        7: 'audio/demo-phase-7.mp3',
        8: 'audio/demo-phase-8.mp3',
        9: 'audio/demo-phase-9.mp3',
        10: 'audio/demo-phase-10.mp3',
        11: 'audio/demo-phase-11.mp3',
        12: 'audio/demo-phase-12.mp3'
      },

      // Preloaded audio elements for instant playback
      preloadedAudio: {},

      async init() {
        // Set up event listeners
        document.getElementById('demo-audio-toggle').addEventListener('click', () => this.toggle());

        // Add click listeners to phase list items
        document.querySelectorAll('.phase-list li').forEach(item => {
          item.addEventListener('click', () => {
            const phase = parseInt(item.dataset.phase);
            jumpToPhase(phase);
          });
        });

        console.log('DemoAudioController initialized (individual clips mode)');
      },

      // Preload all audio files for instant playback
      async preloadAll() {
        console.log('Preloading demo audio clips...');
        const promises = [];

        for (const [phase, url] of Object.entries(this.audioFiles)) {
          const audio = new Audio(url);
          audio.preload = 'auto';

          // Set up event listeners
          audio.addEventListener('ended', () => this.onEnded());
          audio.addEventListener('play', () => {
            this.isPlaying = true;
            this.updateUI();
          });
          audio.addEventListener('pause', () => {
            this.isPlaying = false;
            this.updateUI();
          });

          this.preloadedAudio[phase] = audio;

          // Wait for audio to be ready
          promises.push(new Promise(resolve => {
            audio.addEventListener('canplaythrough', resolve, { once: true });
            audio.addEventListener('error', resolve, { once: true });
          }));
        }

        await Promise.all(promises);
        console.log('All demo audio clips preloaded');
      },

      toggle() {
        this.enabled = !this.enabled;
        const btn = document.getElementById('demo-audio-toggle');
        const progress = document.getElementById('demo-audio-progress');

        if (this.enabled) {
          btn.classList.add('active');
          btn.innerHTML = '<i class="fa-solid fa-volume-high"></i> Audio On';
          progress.style.display = 'block';

          // Preload all clips on first enable
          if (Object.keys(this.preloadedAudio).length === 0) {
            this.preloadAll();
          }
        } else {
          btn.classList.remove('active');
          btn.innerHTML = '<i class="fa-solid fa-volume-xmark"></i> Audio Off';
          progress.style.display = 'none';

          // Stop any playing audio
          this.stopAll();
        }
      },

      // Stop all audio
      stopAll() {
        for (const audio of Object.values(this.preloadedAudio)) {
          audio.pause();
          audio.currentTime = 0;
        }
        this.audio = null;
        this.isPlaying = false;
        this.currentPhase = null;

        // Remove speaking indicators
        document.querySelectorAll('.phase-list li').forEach(item => {
          item.classList.remove('speaking');
        });
      },

      onEnded() {
        this.isPlaying = false;
        this.currentPhase = null;

        // Remove speaking indicators
        document.querySelectorAll('.phase-list li').forEach(item => {
          item.classList.remove('speaking');
        });

        this.updateUI();
      },

      updateUI() {
        const progress = document.getElementById('demo-audio-progress');
        if (!this.audio || !this.isPlaying) {
          document.getElementById('demo-audio-fill').style.width = '0%';
          return;
        }

        // Update progress bar during playback
        if (this.audio.duration > 0) {
          const percent = (this.audio.currentTime / this.audio.duration) * 100;
          document.getElementById('demo-audio-fill').style.width = `${percent}%`;
        }
      },

      // Play audio for a specific phase
      playPhaseAudio(phase) {
        if (!this.enabled) return;

        // Stop any currently playing audio
        this.stopAll();

        const audioKey = phase === 'intro' ? 'intro' : phase;
        let audio = this.preloadedAudio[audioKey];

        // If not preloaded, create new audio element
        if (!audio) {
          const url = this.audioFiles[audioKey];
          if (!url) {
            console.warn('No audio file for phase:', phase);
            return;
          }
          audio = new Audio(url);
          audio.addEventListener('ended', () => this.onEnded());
          audio.addEventListener('play', () => {
            this.isPlaying = true;
            this.updateUI();
          });
          audio.addEventListener('pause', () => {
            this.isPlaying = false;
            this.updateUI();
          });
          this.preloadedAudio[audioKey] = audio;
        }

        // Play the audio
        this.audio = audio;
        this.currentPhase = phase;
        audio.currentTime = 0;
        audio.play().catch(e => console.warn('Could not play audio:', e));

        // Update speaking indicators
        document.querySelectorAll('.phase-list li').forEach(item => {
          const itemPhase = parseInt(item.dataset.phase);
          if (itemPhase === phase) {
            item.classList.add('speaking');
          } else {
            item.classList.remove('speaking');
          }
        });

        // Update progress bar periodically
        const updateInterval = setInterval(() => {
          if (this.audio === audio && this.isPlaying) {
            this.updateUI();
          } else {
            clearInterval(updateInterval);
          }
        }, 100);

        console.log('Playing audio for phase:', phase);
      },

      // Play intro audio
      playIntro() {
        this.playPhaseAudio('intro');
      },

      // Pause current audio
      pause() {
        if (this.audio && this.isPlaying) {
          this.audio.pause();
        }
      },

      // Resume current audio
      resume() {
        if (this.audio && !this.isPlaying) {
          this.audio.play().catch(e => console.warn('Could not resume audio:', e));
        }
      },

      // Sync with demo scene change - plays the appropriate phase audio
      syncToScene(sceneIndex) {
        if (!this.enabled) return;

        const scene = demoScenes[sceneIndex];
        if (!scene) return;

        const phase = scene.phase;

        // Don't restart if already playing this phase
        if (this.currentPhase === phase && this.isPlaying) return;

        // Play the phase audio
        this.playPhaseAudio(phase);
      }
    };

    // Initialize demo audio controller
    demoAudioController.init();

    // Hook into demo scene changes - modify showScene to sync audio
    const originalShowScene = showScene;
    showScene = function(sceneIndex, fromLine = 0) {
      originalShowScene(sceneIndex, fromLine);
      demoAudioController.syncToScene(sceneIndex);
    };

    // Hook into autoplay start to start audio
    const originalStartAutoplay = startAutoplay;
    startAutoplay = function() {
      originalStartAutoplay();
      // Always sync audio when autoplay starts (if enabled)
      if (demoAudioController.enabled) {
        demoAudioController.syncToScene(currentScene);
      }
    };

    // Hook into autoplay stop to pause audio
    const originalStopAutoplay = stopAutoplay;
    stopAutoplay = function() {
      originalStopAutoplay();
      demoAudioController.pause();
    };

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>

  <!-- Narration Floating Bar (must be in DOM before NarrationController script runs) -->
  <div id="narration-bar" class="narration-bar hidden">
    <div class="narration-controls">
      <button id="narration-play" class="narration-btn" title="Play/Pause">
        <i class="fa-solid fa-play"></i>
      </button>

      <div class="narration-progress">
        <div class="progress-track">
          <div class="progress-fill"></div>
          <div class="progress-handle" id="narration-handle"></div>
          <div class="section-markers" id="section-markers"></div>
        </div>
      </div>

      <div class="narration-time">
        <span id="narration-current">0:00</span>
        <span>/</span>
        <span id="narration-duration">0:00</span>
      </div>

      <button id="narration-mute" class="narration-btn" title="Mute/Unmute">
        <i class="fa-solid fa-volume-high"></i>
      </button>

      <button id="narration-close" class="narration-btn" title="Close">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div id="narration-subtitles" class="narration-subtitles">
      Click play to start the narrated tour...
    </div>
  </div>

  <script>
    // ============================================
    // NARRATION CONTROLLER
    // Audio sync with subtitles, page scroll, and element highlighting
    // ============================================
    class NarrationController {
      constructor(audioUrl, timingUrl) {
        this.audioUrl = audioUrl;
        this.timingUrl = timingUrl;
        this.audio = null;
        this.timing = null;
        this.isPlaying = false;
        this.isMuted = false;
        this.lastScrolledSection = null;
        this.isDragging = false;
        this.isSeeking = false; // Prevent onTimeUpdate from overriding seek position
        this.demoPauseTriggered = false; // Track if we've already paused for demo section

        // DOM elements - will be set in init()
        this.bar = null;
        this.playBtn = null;
        this.muteBtn = null;
        this.progressFill = null;
        this.handle = null;
        this.progressTrack = null;
        this.currentTimeEl = null;
        this.durationEl = null;
        this.subtitles = null;
        this.launchBtn = null;
        this.sectionMarkers = null;

        this.init();
      }

      async init(embeddedTiming = null) {
        // Get DOM elements
        this.bar = document.getElementById('narration-bar');
        this.playBtn = document.getElementById('narration-play');
        this.muteBtn = document.getElementById('narration-mute');
        this.progressFill = document.querySelector('.narration-progress .progress-fill');
        this.handle = document.getElementById('narration-handle');
        this.progressTrack = document.querySelector('.narration-progress .progress-track');
        this.currentTimeEl = document.getElementById('narration-current');
        this.durationEl = document.getElementById('narration-duration');
        this.subtitles = document.getElementById('narration-subtitles');
        this.launchBtn = document.getElementById('narration-launch');
        this.sectionMarkers = document.getElementById('section-markers');

        // Load audio
        this.audio = new Audio(this.audioUrl);
        this.audio.preload = 'metadata';

        // Use embedded timing if provided, otherwise try to fetch
        if (embeddedTiming) {
          this.timing = embeddedTiming;
        } else {
          try {
            // Try to fetch timing data (works with http://, not file://)
            const response = await fetch(this.timingUrl);
            if (!response.ok) {
              console.warn('Narration timing file not found.');
              this.subtitles.textContent = 'Click the Narrated Tour button to begin...';
              this.setupEventListeners();
              return;
            }
            this.timing = await response.json();
          } catch (err) {
            // Fetch failed (likely file:// CORS) - that's OK, will load timing when voice is selected
            console.log('Timing will be loaded when voice is selected (file:// mode)');
            this.subtitles.textContent = 'Click the Narrated Tour button to begin...';
            this.setupEventListeners();
            return;
          }
        }

        // Set duration display
        this.durationEl.textContent = this.formatTime(this.timing.duration);

        // Add section markers to progress bar
        this.addSectionMarkers();

        // Set up event listeners
        this.setupEventListeners();

        console.log('Narration controller initialized:', {
          duration: this.timing.duration,
          sections: this.timing.sections.length,
          highlights: this.timing.highlights.length,
          words: this.timing.words ? this.timing.words.length : 0
        });
      }

      setupEventListeners() {
        // Play/pause button
        if (this.playBtn) {
          this.playBtn.addEventListener('click', () => this.togglePlay());
        }

        // Mute button
        if (this.muteBtn) {
          this.muteBtn.addEventListener('click', () => this.toggleMute());
        }

        // Audio event listeners (will be re-attached when voice changes)
        this.attachAudioListeners();

        // Progress bar click/tap to seek - use the entire progress wrapper
        const progressWrapper = document.querySelector('.narration-progress');
        if (progressWrapper) {
          // Click handler for mouse
          progressWrapper.addEventListener('click', (e) => {
            // Don't seek if clicking on the handle (that's for dragging)
            if (e.target === this.handle) return;
            this.seek(e);
          });

          // Touch handler for mobile - more reliable than click on touch devices
          progressWrapper.addEventListener('touchend', (e) => {
            // Don't seek if touching the handle (that's for dragging)
            if (e.target === this.handle) return;
            // Use the touch position
            if (e.changedTouches && e.changedTouches.length > 0) {
              const touch = e.changedTouches[0];
              // Create a fake event with clientX from the touch
              this.seek({ clientX: touch.clientX });
            }
          }, { passive: true });
        }

        // Handle drag for scrubbing
        if (this.handle) {
          this.handle.addEventListener('mousedown', (e) => this.startDrag(e));
          this.handle.addEventListener('touchstart', (e) => this.startDrag(e), { passive: false });
        }
        document.addEventListener('mousemove', (e) => this.onDrag(e));
        document.addEventListener('mouseup', () => this.endDrag());
        document.addEventListener('touchmove', (e) => this.onDrag(e), { passive: false });
        document.addEventListener('touchend', () => this.endDrag());

        // Launch button - only add if element exists (it may be loaded later)
        if (this.launchBtn) {
          this.launchBtn.addEventListener('click', () => this.show());
        }

        // Close button - always get fresh reference
        const closeBtn = document.getElementById('narration-close');
        if (closeBtn) {
          closeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('Close button clicked');
            this.hide();
          });
        }
      }

      attachAudioListeners() {
        if (!this.audio) return;

        // Audio time update
        this.audio.addEventListener('timeupdate', () => this.onTimeUpdate());

        // Audio ended
        this.audio.addEventListener('ended', () => {
          this.isPlaying = false;
          if (this.playBtn) this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        });
      }

      togglePlay() {
        if (!this.timing) return;

        if (this.isPlaying) {
          this.audio.pause();
          this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        } else {
          this.audio.play();
          this.playBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
        }
        this.isPlaying = !this.isPlaying;
      }

      toggleMute() {
        this.isMuted = !this.isMuted;
        this.audio.muted = this.isMuted;
        this.muteBtn.innerHTML = this.isMuted
          ? '<i class="fa-solid fa-volume-xmark"></i>'
          : '<i class="fa-solid fa-volume-high"></i>';
      }

      onTimeUpdate() {
        if (!this.timing || this.isDragging || this.isSeeking) return;

        const currentTime = this.audio.currentTime;
        const progress = (currentTime / this.timing.duration) * 100;

        // Update progress bar
        this.progressFill.style.width = `${progress}%`;
        this.handle.style.left = `${progress}%`;
        this.currentTimeEl.textContent = this.formatTime(currentTime);

        // Update subtitles with word-level highlighting
        this.updateSubtitles(currentTime);

        // Scroll page to current section
        this.scrollToCurrentSection(currentTime);

        // Trigger element highlights
        this.triggerHighlights(currentTime);
      }

      updateSubtitles(currentTime) {
        const words = this.timing.words;

        // If no word-level timing (file:// mode), show section-based text instead
        if (!words || words.length === 0) {
          // Find current section and show its name
          const sections = this.timing.sections;
          let currentSection = sections[0];
          for (const section of sections) {
            if (currentTime >= section.timestamp) {
              currentSection = section;
            }
          }
          const sectionNames = {
            hero: 'Welcome to API Dev Tools...',
            problem: 'Six failure modes...',
            solution: 'Six fixes with Python hooks...',
            grounding: 'Research grounding...',
            hooks: 'Workflow enforcement...',
            phases: 'The 12 phases...',
            demo: 'See it in action...',
            state: 'Persistent memory...',
            install: 'Get started...'
          };
          this.subtitles.textContent = sectionNames[currentSection?.id] || 'Playing...';
          return;
        }

        const windowSize = 10; // Show ~10 words at a time

        // Find the current word
        let currentIndex = -1;
        for (let i = 0; i < words.length; i++) {
          if (currentTime >= words[i].start && currentTime <= words[i].end) {
            currentIndex = i;
            break;
          }
          // If we're between words, use the next word
          if (i < words.length - 1 && currentTime > words[i].end && currentTime < words[i + 1].start) {
            currentIndex = i;
            break;
          }
        }

        if (currentIndex === -1) {
          // Before first word or after last
          if (currentTime < words[0]?.start) {
            this.subtitles.textContent = 'Starting...';
          }
          return;
        }

        // Calculate window around current word
        const startIndex = Math.max(0, currentIndex - 4);
        const endIndex = Math.min(words.length, startIndex + windowSize);

        // Build subtitle text with current word highlighted
        const displayWords = words.slice(startIndex, endIndex).map((w, i) => {
          const actualIndex = startIndex + i;
          const isActive = actualIndex === currentIndex;
          return isActive
            ? `<span class="highlight">${w.word}</span>`
            : w.word;
        });

        this.subtitles.innerHTML = displayWords.join(' ');
      }

      scrollToCurrentSection(currentTime) {
        const sections = this.timing.sections;
        let currentSection = null;

        // Find the current section
        for (const section of sections) {
          if (currentTime >= section.timestamp) {
            currentSection = section;
          }
        }

        if (!currentSection) return;

        // Only scroll if section changed
        if (this.lastScrolledSection !== currentSection.id) {
          const element = document.getElementById(currentSection.id);
          if (element) {
            // Scroll with offset to account for fixed nav
            const navHeight = 70;
            const elementTop = element.getBoundingClientRect().top + window.scrollY - navHeight;
            window.scrollTo({
              top: elementTop,
              behavior: 'smooth'
            });
            this.lastScrolledSection = currentSection.id;
          }
        }
      }

      triggerHighlights(currentTime) {
        const highlights = this.timing.highlights;
        const highlightDuration = 2; // seconds to show highlight

        for (const highlight of highlights) {
          try {
            const el = document.querySelector(highlight.selector);
            if (!el) continue;

            const isActive = currentTime >= highlight.timestamp &&
                            currentTime < highlight.timestamp + highlightDuration;

            if (isActive && !el.classList.contains('narration-highlight')) {
              el.classList.add('narration-highlight');
              gsap.to(el, {
                scale: 1.02,
                boxShadow: '0 0 25px rgba(186, 12, 47, 0.5)',
                duration: 0.3
              });

              // Special behavior for demo controls - pause and highlight play button
              if (highlight.selector === '.demo-controls' && !this.demoPauseTriggered) {
                this.demoPauseTriggered = true;
                this.pauseForDemo();
              }
            } else if (!isActive && el.classList.contains('narration-highlight')) {
              el.classList.remove('narration-highlight');
              gsap.to(el, {
                scale: 1,
                boxShadow: 'none',
                duration: 0.3
              });
            }
          } catch (e) {
            // Invalid selector, skip
          }
        }
      }

      // Pause main narration and highlight demo play button
      pauseForDemo() {
        // Pause the narration
        if (this.audio && this.isPlaying) {
          this.audio.pause();
          this.isPlaying = false;
          if (this.playBtn) this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        }

        // Highlight the demo play button
        const demoPlayBtn = document.getElementById('demo-play');
        if (demoPlayBtn) {
          demoPlayBtn.classList.add('pulse-hint');
          demoPlayBtn.innerHTML = '<i class="fa-solid fa-play"></i> Tap to Start Demo';

          // Show a tooltip/message
          const message = document.createElement('div');
          message.className = 'demo-prompt-message';
          message.innerHTML = '<i class="fa-solid fa-arrow-down"></i> Try the interactive demo!';
          demoPlayBtn.parentElement.insertBefore(message, demoPlayBtn);

          // Remove message and hint after demo starts or after timeout
          const cleanup = () => {
            demoPlayBtn.classList.remove('pulse-hint');
            demoPlayBtn.innerHTML = '<i class="fa-solid fa-play"></i> Auto-play';
            if (message.parentElement) message.remove();
          };

          // Cleanup when demo starts playing
          demoPlayBtn.addEventListener('click', cleanup, { once: true });

          // Also cleanup after 30 seconds if user doesn't interact
          setTimeout(cleanup, 30000);
        }

        // Update subtitles to prompt user
        if (this.subtitles) {
          this.subtitles.textContent = 'Try the interactive demo below, then tap Play to continue...';
        }
      }

      seek(event) {
        console.log('seek() called', {
          hasTiming: !!this.timing,
          hasAudio: !!this.audio,
          audioReadyState: this.audio ? this.audio.readyState : 'no audio',
          timingDuration: this.timing ? this.timing.duration : 'no timing'
        });

        if (!this.timing) {
          console.log('seek: no timing data');
          return;
        }

        if (!this.audio) {
          console.log('seek: no audio element');
          return;
        }

        // Get the progress track for accurate positioning
        const progressTrack = document.querySelector('.narration-progress .progress-track');
        if (!progressTrack) {
          console.log('seek: no progress track');
          return;
        }

        const rect = progressTrack.getBoundingClientRect();
        console.log('seek: rect', { left: rect.left, width: rect.width, clientX: event.clientX });

        const percent = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));
        const newTime = percent * this.timing.duration;

        console.log('seek: calculated', { percent: (percent * 100).toFixed(1) + '%', newTime: newTime.toFixed(1), duration: this.timing.duration.toFixed(1) });

        // Set seeking flag to prevent onTimeUpdate from overriding our UI updates
        this.isSeeking = true;

        // Update UI immediately
        if (this.progressFill) this.progressFill.style.width = `${percent * 100}%`;
        if (this.handle) this.handle.style.left = `${percent * 100}%`;
        if (this.currentTimeEl) this.currentTimeEl.textContent = this.formatTime(newTime);

        // Set audio time - need to ensure audio is ready to seek
        if (this.audio.readyState >= 1) {
          // HAVE_METADATA or higher - can set currentTime
          try {
            this.audio.currentTime = newTime;
            console.log('seek: audio.currentTime set to', this.audio.currentTime);
          } catch (e) {
            console.warn('seek: could not set audio time', e);
          }
        } else {
          // Audio not ready yet - queue the seek
          console.log('seek: audio not ready, queuing seek to', newTime);
          const pendingSeek = newTime;
          this.audio.addEventListener('loadedmetadata', () => {
            console.log('seek: audio now ready, seeking to', pendingSeek);
            this.audio.currentTime = pendingSeek;
          }, { once: true });
        }

        // Clear seeking flag after audio has seeked (or after a short timeout as fallback)
        this.audio.addEventListener('seeked', () => {
          console.log('seek: audio seeked event fired');
          this.isSeeking = false;
        }, { once: true });

        // Fallback: clear seeking flag after 500ms in case seeked event doesn't fire
        setTimeout(() => {
          this.isSeeking = false;
        }, 500);

        // Update subtitles immediately to show text at new position
        this.updateSubtitles(newTime);
      }

      startDrag(e) {
        e.preventDefault();
        this.isDragging = true;
        this.handle.style.cursor = 'grabbing';
      }

      onDrag(e) {
        if (!this.isDragging || !this.timing) return;

        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const rect = this.progressTrack.getBoundingClientRect();
        const percent = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));

        // Update visual position
        this.progressFill.style.width = `${percent * 100}%`;
        this.handle.style.left = `${percent * 100}%`;

        const newTime = percent * this.timing.duration;
        this.currentTimeEl.textContent = this.formatTime(newTime);
      }

      endDrag() {
        if (!this.isDragging) return;

        this.isDragging = false;
        this.handle.style.cursor = 'grab';

        // Seek to final position
        const percent = parseFloat(this.handle.style.left) / 100;
        if (!isNaN(percent) && this.timing) {
          this.audio.currentTime = percent * this.timing.duration;
          this.lastScrolledSection = null;
        }
      }

      addSectionMarkers() {
        if (!this.sectionMarkers || !this.timing) return;

        this.sectionMarkers.innerHTML = '';

        // Section display names
        const sectionNames = {
          hero: 'Intro',
          problem: 'Problem',
          solution: 'Solution',
          grounding: 'Research',
          hooks: 'Workflow',
          phases: '12 Phases',
          demo: 'Demo',
          state: 'Memory',
          install: 'Install'
        };

        // Add markers with labels
        for (const section of this.timing.sections) {
          const marker = document.createElement('div');
          marker.className = 'section-marker';
          const percent = (section.timestamp / this.timing.duration) * 100;
          marker.style.left = `${percent}%`;

          // Add label inside marker (shows on hover)
          const label = document.createElement('span');
          label.className = 'section-label';
          label.textContent = sectionNames[section.id] || section.id;
          marker.appendChild(label);

          // Click/tap to seek to section - shared handler
          const seekToSection = (e) => {
            e.stopPropagation();
            console.log('Section marker clicked/tapped:', section.id, 'timestamp:', section.timestamp);

            if (!this.audio) {
              console.log('Section marker: no audio');
              return;
            }

            const newTime = section.timestamp;
            const pct = (newTime / this.timing.duration) * 100;

            // Update UI immediately
            if (this.progressFill) this.progressFill.style.width = `${pct}%`;
            if (this.handle) this.handle.style.left = `${pct}%`;
            if (this.currentTimeEl) this.currentTimeEl.textContent = this.formatTime(newTime);

            // Set audio time
            if (this.audio.readyState >= 1) {
              this.audio.currentTime = newTime;
              console.log('Section seek: audio.currentTime set to', this.audio.currentTime);
            } else {
              console.log('Section seek: audio not ready, queuing');
              this.audio.addEventListener('loadedmetadata', () => {
                this.audio.currentTime = newTime;
              }, { once: true });
            }

            // Update subtitles
            this.updateSubtitles(newTime);
          };

          marker.addEventListener('click', seekToSection);
          marker.addEventListener('touchend', seekToSection, { passive: false });

          this.sectionMarkers.appendChild(marker);
        }

        // Add fixed labels above the bar
        const labelsContainer = document.createElement('div');
        labelsContainer.className = 'section-labels';

        for (const section of this.timing.sections) {
          const percent = (section.timestamp / this.timing.duration) * 100;
          // Only show labels that aren't too close together (skip intro at 0)
          if (percent > 5) {
            const labelEl = document.createElement('span');
            labelEl.className = 'section-label-fixed';
            labelEl.style.left = `${percent}%`;
            labelEl.textContent = sectionNames[section.id] || section.id;
            labelsContainer.appendChild(labelEl);
          }
        }

        // Insert labels container before the progress wrapper
        const progressWrapper = document.querySelector('.narration-progress');
        if (progressWrapper && !progressWrapper.querySelector('.section-labels')) {
          progressWrapper.insertBefore(labelsContainer, progressWrapper.firstChild);
        }
      }

      show() {
        if (this.bar) this.bar.classList.remove('hidden');
        // launchBtn may be null if called before DOM is ready - get it fresh
        const launchBtn = document.getElementById('narration-launch');
        if (launchBtn) launchBtn.classList.add('hidden');
      }

      hide() {
        if (this.bar) this.bar.classList.add('hidden');
        const launchBtn = document.getElementById('narration-launch');
        if (launchBtn) launchBtn.classList.remove('hidden');
        if (this.audio) {
          this.audio.pause();
        }
        this.isPlaying = false;
        if (this.playBtn) this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';

        // Clear any active highlights
        document.querySelectorAll('.narration-highlight').forEach(el => {
          el.classList.remove('narration-highlight');
          gsap.set(el, { scale: 1, boxShadow: 'none' });
        });
      }

      formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      async loadVoice(audioUrl, timingUrl) {
        // Stop current playback
        if (this.isPlaying) {
          this.audio.pause();
          this.isPlaying = false;
          this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        }

        // Clear highlights
        document.querySelectorAll('.narration-highlight').forEach(el => {
          el.classList.remove('narration-highlight');
          gsap.set(el, { scale: 1, boxShadow: 'none' });
        });

        // Load new audio
        this.audioUrl = audioUrl;
        this.timingUrl = timingUrl;
        this.audio = new Audio(audioUrl);
        this.audio.preload = 'metadata';

        try {
          // Load new timing data
          const response = await fetch(timingUrl);
          if (!response.ok) {
            console.warn('Timing file not found:', timingUrl);
            this.subtitles.textContent = 'Audio not yet generated for this voice.';
            return;
          }
          this.timing = await response.json();

          // Update duration
          this.durationEl.textContent = this.formatTime(this.timing.duration);

          // Reset progress
          this.progressFill.style.width = '0%';
          this.handle.style.left = '0%';
          this.currentTimeEl.textContent = '0:00';
          this.lastScrolledSection = null;

          // Rebuild section markers
          this.addSectionMarkers();

          // Re-attach event listeners to new audio
          this.audio.addEventListener('timeupdate', () => this.onTimeUpdate());
          this.audio.addEventListener('ended', () => {
            this.isPlaying = false;
            this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
          });

          this.subtitles.textContent = 'Click play to start the narrated tour...';
          console.log('Voice loaded:', audioUrl);
        } catch (err) {
          console.warn('Could not load voice timing:', err);
          this.subtitles.textContent = 'Audio not yet generated for this voice.';
        }
      }

      // Load voice with pre-loaded timing data (no fetch needed - works with file://)
      // Returns a promise that resolves when audio is ready to play
      loadVoiceWithTiming(audioUrl, timingData) {
        return new Promise((resolve, reject) => {
          console.log('loadVoiceWithTiming START:', audioUrl);

          // Stop current playback
          if (this.audio && this.isPlaying) {
            this.audio.pause();
            this.isPlaying = false;
            if (this.playBtn) this.playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
          }

          // Clear highlights
          console.log('Clearing highlights...');
          document.querySelectorAll('.narration-highlight').forEach(el => {
            el.classList.remove('narration-highlight');
            gsap.set(el, { scale: 1, boxShadow: 'none' });
          });

          // Load new audio
          console.log('Creating new Audio element...');
          this.audioUrl = audioUrl;
          this.audio = new Audio(audioUrl);
          this.audio.preload = 'auto';

          // Use embedded timing data directly (no fetch!)
          console.log('Setting timing data...');
          this.timing = timingData;

          // Update duration
          console.log('Updating duration display...');
          if (this.durationEl) this.durationEl.textContent = this.formatTime(this.timing.duration);

          // Reset progress
          console.log('Resetting progress...');
          if (this.progressFill) this.progressFill.style.width = '0%';
          if (this.handle) this.handle.style.left = '0%';
          if (this.currentTimeEl) this.currentTimeEl.textContent = '0:00';
          this.lastScrolledSection = null;

          // Rebuild section markers
          console.log('Adding section markers...');
          this.addSectionMarkers();

          // Re-attach event listeners to new audio
          console.log('Attaching audio event listeners...');
          this.attachAudioListeners();

          // Wait for audio to be ready
          this.audio.addEventListener('canplaythrough', () => {
            console.log('Audio ready to play:', audioUrl);
            if (this.subtitles) this.subtitles.textContent = 'Ready to play...';
            resolve();
          }, { once: true });

          this.audio.addEventListener('error', (e) => {
            console.error('Audio load error:', e);
            if (this.subtitles) this.subtitles.textContent = 'Error loading audio.';
            reject(e);
          }, { once: true });

          console.log('Setting subtitle text...');
          if (this.subtitles) this.subtitles.textContent = 'Loading audio...';
          console.log('loadVoiceWithTiming waiting for audio to load...');
        });
      }
    }

    // Initialize narration controller after DOM is ready
    const narrationController = new NarrationController(
      'audio/narration-male.mp3',
      'audio/narration-male-timing.json'
    );
  </script>

  <!-- Narration Launch Button -->
  <button id="narration-launch" class="narration-launch-btn">
    <i class="fa-solid fa-headphones"></i> Narrated Tour
  </button>

  <!-- Voice Selector Panel -->
  <div id="voice-selector" class="voice-selector">
    <button class="voice-selector-close" onclick="document.getElementById('voice-selector').classList.remove('visible'); document.getElementById('narration-launch').classList.remove('hidden');">
      <i class="fa-solid fa-xmark"></i>
    </button>
    <h4><i class="fa-solid fa-microphone"></i> Choose Voice</h4>

    <div class="voice-options">
      <div class="voice-option" data-voice="male" onclick="selectVoice(this)">
        <div class="voice-icon">
          <i class="fa-solid fa-user-tie"></i>
        </div>
        <div class="voice-info">
          <div class="voice-name">Aidan</div>
          <div class="voice-desc">Social media influencer</div>
        </div>
      </div>

      <div class="voice-option" data-voice="female" onclick="selectVoice(this)">
        <div class="voice-icon">
          <i class="fa-solid fa-user"></i>
        </div>
        <div class="voice-info">
          <div class="voice-name">Bella</div>
          <div class="voice-desc">Chatty social media influencer</div>
        </div>
      </div>

      <div class="voice-option santa-option selected" data-voice="santa" onclick="selectVoice(this)">
        <div class="snowflakes">
          <span class="snowflake">â„</span>
          <span class="snowflake">â„</span>
          <span class="snowflake">â„</span>
          <span class="snowflake">â„</span>
          <span class="snowflake">â„</span>
        </div>
        <div class="voice-icon">
          <i class="fa-solid fa-tree"></i>
        </div>
        <div class="voice-info">
          <div class="voice-name">Santa</div>
          <div class="voice-desc">Festive holiday narrator</div>
        </div>
      </div>
    </div>

    <button class="voice-selector-play" onclick="startNarration()">
      <i class="fa-solid fa-play"></i> Start Tour
    </button>

    <p class="voice-note">Select a voice to begin the narrated tour</p>
  </div>

  <script>
    // Embedded timing data (sections + highlights only, no word-level for file:// compatibility)
    const embeddedTimingData = {
      male: {
        duration: 538.237,
        sections: [
          { id: "hero", timestamp: 0 },
          { id: "problem", timestamp: 31.475 },
          { id: "solution", timestamp: 117.494 },
          { id: "grounding", timestamp: 199.345 },
          { id: "hooks", timestamp: 230.111 },
          { id: "phases", timestamp: 288.404 },
          { id: "demo", timestamp: 385.672 },
          { id: "state", timestamp: 422.093 },
          { id: "install", timestamp: 483.973 }
        ],
        highlights: [
          { selector: ".hero-badge", section: "hero", timestamp: 3.785 },
          { selector: ".hero-tagline", section: "hero", timestamp: 8.487 },
          { selector: ".hero-terminal", section: "hero", timestamp: 14.478 },
          { selector: "#problem h2", section: "problem", timestamp: 31.475 },
          { selector: ".problem-card:nth-child(1)", section: "problem", timestamp: 39.532 },
          { selector: ".problem-card:nth-child(2)", section: "problem", timestamp: 53.94 },
          { selector: ".problem-card:nth-child(3)", section: "problem", timestamp: 67.582 },
          { selector: ".problem-card:nth-child(4)", section: "problem", timestamp: 80.353 },
          { selector: ".problem-card:nth-child(5)", section: "problem", timestamp: 92.23 },
          { selector: ".problem-card:nth-child(6)", section: "problem", timestamp: 104.212 },
          { selector: "#solution h2", section: "solution", timestamp: 117.494 },
          { selector: ".solution-card:nth-child(1)", section: "solution", timestamp: 124.669 },
          { selector: ".solution-card:nth-child(2)", section: "solution", timestamp: 137.498 },
          { selector: ".solution-card:nth-child(3)", section: "solution", timestamp: 148.83 },
          { selector: ".solution-card:nth-child(4)", section: "solution", timestamp: 161.612 },
          { selector: ".solution-card:nth-child(5)", section: "solution", timestamp: 174.72 },
          { selector: ".solution-card:nth-child(6)", section: "solution", timestamp: 187.839 },
          { selector: "#grounding h2", section: "grounding", timestamp: 199.345 },
          { selector: ".grounding-tools", section: "grounding", timestamp: 204.836 },
          { selector: ".grounding-example", section: "grounding", timestamp: 214.635 },
          { selector: "#hooks h2", section: "hooks", timestamp: 230.111 },
          { selector: ".hook-types", section: "hooks", timestamp: 237.263 },
          { selector: ".exit-code-callout", section: "hooks", timestamp: 250.974 },
          { selector: ".exit-code-demo", section: "hooks", timestamp: 264.941 },
          { selector: "#phases h2", section: "phases", timestamp: 288.404 },
          { selector: ".phase-card:nth-child(1)", section: "phases", timestamp: 293.048 },
          { selector: ".phase-card:nth-child(2)", section: "phases", timestamp: 302.847 },
          { selector: ".phase-card:nth-child(3)", section: "phases", timestamp: 309.29 },
          { selector: ".phase-card:nth-child(4)", section: "phases", timestamp: 315.176 },
          { selector: ".phase-card:nth-child(5)", section: "phases", timestamp: 322.572 },
          { selector: ".phase-card:nth-child(6)", section: "phases", timestamp: 329.213 },
          { selector: ".phase-card:nth-child(7)", section: "phases", timestamp: 336.597 },
          { selector: ".phase-card:nth-child(8)", section: "phases", timestamp: 342.216 },
          { selector: ".phase-card:nth-child(9)", section: "phases", timestamp: 349.612 },
          { selector: ".phase-card:nth-child(10)", section: "phases", timestamp: 354.314 },
          { selector: ".phase-card:nth-child(11)", section: "phases", timestamp: 364.252 },
          { selector: ".phase-card:nth-child(12)", section: "phases", timestamp: 370.498 },
          { selector: "#demo h2", section: "demo", timestamp: 385.672 },
          { selector: ".demo-terminal", section: "demo", timestamp: 389.132 },
          { selector: ".demo-controls", section: "demo", timestamp: 393.915 },
          { selector: ".phase-progress-bar", section: "demo", timestamp: 401.937 },
          { selector: ".demo-explanation", section: "demo", timestamp: 409.844 },
          { selector: "#state h2", section: "state", timestamp: 422.093 },
          { selector: ".state-highlight-box:nth-child(1)", section: "state", timestamp: 428.792 },
          { selector: ".state-highlight-box:nth-child(2)", section: "state", timestamp: 445.939 },
          { selector: ".state-code", section: "state", timestamp: 466.117 },
          { selector: "#install h2", section: "install", timestamp: 483.973 },
          { selector: ".install-command", section: "install", timestamp: 490.149 },
          { selector: ".claude-features", section: "install", timestamp: 494.015 },
          { selector: ".install-links", section: "install", timestamp: 507.959 }
        ],
        words: []
      },
      female: {
        duration: 517.944,
        sections: [
          { id: "hero", timestamp: 0 },
          { id: "problem", timestamp: 27.04 },
          { id: "solution", timestamp: 113.127 },
          { id: "grounding", timestamp: 195.964 },
          { id: "hooks", timestamp: 223.015 },
          { id: "phases", timestamp: 278.279 },
          { id: "demo", timestamp: 367.537 },
          { id: "state", timestamp: 401.333 },
          { id: "install", timestamp: 463.935 }
        ],
        highlights: [
          { selector: ".hero-badge", section: "hero", timestamp: 3.355 },
          { selector: ".hero-tagline", section: "hero", timestamp: 7.976 },
          { selector: ".hero-terminal", section: "hero", timestamp: 13.944 },
          { selector: "#problem h2", section: "problem", timestamp: 27.04 },
          { selector: ".problem-card:nth-child(1)", section: "problem", timestamp: 35.305 },
          { selector: ".problem-card:nth-child(2)", section: "problem", timestamp: 49.319 },
          { selector: ".problem-card:nth-child(3)", section: "problem", timestamp: 62.855 },
          { selector: ".problem-card:nth-child(4)", section: "problem", timestamp: 74.442 },
          { selector: ".problem-card:nth-child(5)", section: "problem", timestamp: 85.611 },
          { selector: ".problem-card:nth-child(6)", section: "problem", timestamp: 97.233 },
          { selector: "#solution h2", section: "solution", timestamp: 113.127 },
          { selector: ".solution-card:nth-child(1)", section: "solution", timestamp: 120.546 },
          { selector: ".solution-card:nth-child(2)", section: "solution", timestamp: 133.27 },
          { selector: ".solution-card:nth-child(3)", section: "solution", timestamp: 144.787 },
          { selector: ".solution-card:nth-child(4)", section: "solution", timestamp: 158.336 },
          { selector: ".solution-card:nth-child(5)", section: "solution", timestamp: 172.605 },
          { selector: ".solution-card:nth-child(6)", section: "solution", timestamp: 184.679 },
          { selector: "#grounding h2", section: "grounding", timestamp: 195.964 },
          { selector: ".grounding-tools", section: "grounding", timestamp: 200.666 },
          { selector: ".grounding-example", section: "grounding", timestamp: 209.002 },
          { selector: "#hooks h2", section: "hooks", timestamp: 223.015 },
          { selector: ".hook-types", section: "hooks", timestamp: 230.283 },
          { selector: ".exit-code-callout", section: "hooks", timestamp: 243.739 },
          { selector: ".exit-code-demo", section: "hooks", timestamp: 255.338 },
          { selector: "#phases h2", section: "phases", timestamp: 278.279 },
          { selector: ".phase-card:nth-child(1)", section: "phases", timestamp: 282.435 },
          { selector: ".phase-card:nth-child(2)", section: "phases", timestamp: 292.281 },
          { selector: ".phase-card:nth-child(3)", section: "phases", timestamp: 298.271 },
          { selector: ".phase-card:nth-child(4)", section: "phases", timestamp: 304.181 },
          { selector: ".phase-card:nth-child(5)", section: "phases", timestamp: 310.799 },
          { selector: ".phase-card:nth-child(6)", section: "phases", timestamp: 316.975 },
          { selector: ".phase-card:nth-child(7)", section: "phases", timestamp: 323.871 },
          { selector: ".phase-card:nth-child(8)", section: "phases", timestamp: 329.48 },
          { selector: ".phase-card:nth-child(9)", section: "phases", timestamp: 337.026 },
          { selector: ".phase-card:nth-child(10)", section: "phases", timestamp: 340.95 },
          { selector: ".phase-card:nth-child(11)", section: "phases", timestamp: 348.427 },
          { selector: ".phase-card:nth-child(12)", section: "phases", timestamp: 354.569 },
          { selector: "#demo h2", section: "demo", timestamp: 367.537 },
          { selector: ".demo-terminal", section: "demo", timestamp: 370.555 },
          { selector: ".demo-controls", section: "demo", timestamp: 375.617 },
          { selector: ".phase-progress-bar", section: "demo", timestamp: 383.117 },
          { selector: ".demo-explanation", section: "demo", timestamp: 390.478 },
          { selector: "#state h2", section: "state", timestamp: 401.333 },
          { selector: ".state-highlight-box:nth-child(1)", section: "state", timestamp: 408.519 },
          { selector: ".state-highlight-box:nth-child(2)", section: "state", timestamp: 426.956 },
          { selector: ".state-code", section: "state", timestamp: 444.789 },
          { selector: "#install h2", section: "install", timestamp: 463.935 },
          { selector: ".install-command", section: "install", timestamp: 471.377 },
          { selector: ".claude-features", section: "install", timestamp: 475.603 },
          { selector: ".install-links", section: "install", timestamp: 487.828 }
        ],
        words: []
      },
      santa: {
        duration: 576.829,
        sections: [
          { id: "hero", timestamp: 0 },
          { id: "problem", timestamp: 31.23 },
          { id: "solution", timestamp: 125.572 },
          { id: "grounding", timestamp: 212.067 },
          { id: "hooks", timestamp: 241.336 },
          { id: "phases", timestamp: 304.134 },
          { id: "demo", timestamp: 412.002 },
          { id: "state", timestamp: 451.499 },
          { id: "install", timestamp: 519.94 }
        ],
        highlights: [
          { selector: ".hero-badge", section: "hero", timestamp: 4.69 },
          { selector: ".hero-tagline", section: "hero", timestamp: 9.659 },
          { selector: ".hero-terminal", section: "hero", timestamp: 15.801 },
          { selector: "#problem h2", section: "problem", timestamp: 31.23 },
          { selector: ".problem-card:nth-child(1)", section: "problem", timestamp: 40.391 },
          { selector: ".problem-card:nth-child(2)", section: "problem", timestamp: 56.773 },
          { selector: ".problem-card:nth-child(3)", section: "problem", timestamp: 72.84 },
          { selector: ".problem-card:nth-child(4)", section: "problem", timestamp: 86.818 },
          { selector: ".problem-card:nth-child(5)", section: "problem", timestamp: 98.556 },
          { selector: ".problem-card:nth-child(6)", section: "problem", timestamp: 110.712 },
          { selector: "#solution h2", section: "solution", timestamp: 125.572 },
          { selector: ".solution-card:nth-child(1)", section: "solution", timestamp: 133.572 },
          { selector: ".solution-card:nth-child(2)", section: "solution", timestamp: 146.285 },
          { selector: ".solution-card:nth-child(3)", section: "solution", timestamp: 158.231 },
          { selector: ".solution-card:nth-child(4)", section: "solution", timestamp: 171.839 },
          { selector: ".solution-card:nth-child(5)", section: "solution", timestamp: 186.664 },
          { selector: ".solution-card:nth-child(6)", section: "solution", timestamp: 199.18 },
          { selector: "#grounding h2", section: "grounding", timestamp: 212.067 },
          { selector: ".grounding-tools", section: "grounding", timestamp: 217.639 },
          { selector: ".grounding-example", section: "grounding", timestamp: 226.324 },
          { selector: "#hooks h2", section: "hooks", timestamp: 241.336 },
          { selector: ".hook-types", section: "hooks", timestamp: 248.905 },
          { selector: ".exit-code-callout", section: "hooks", timestamp: 263.371 },
          { selector: ".exit-code-demo", section: "hooks", timestamp: 277.93 },
          { selector: "#phases h2", section: "phases", timestamp: 304.134 },
          { selector: ".phase-card:nth-child(1)", section: "phases", timestamp: 309.219 },
          { selector: ".phase-card:nth-child(2)", section: "phases", timestamp: 320.307 },
          { selector: ".phase-card:nth-child(3)", section: "phases", timestamp: 327.366 },
          { selector: ".phase-card:nth-child(4)", section: "phases", timestamp: 335.354 },
          { selector: ".phase-card:nth-child(5)", section: "phases", timestamp: 343.074 },
          { selector: ".phase-card:nth-child(6)", section: "phases", timestamp: 350.446 },
          { selector: ".phase-card:nth-child(7)", section: "phases", timestamp: 357.877 },
          { selector: ".phase-card:nth-child(8)", section: "phases", timestamp: 364.785 },
          { selector: ".phase-card:nth-child(9)", section: "phases", timestamp: 373.33 },
          { selector: ".phase-card:nth-child(10)", section: "phases", timestamp: 377.974 },
          { selector: ".phase-card:nth-child(11)", section: "phases", timestamp: 385.868 },
          { selector: ".phase-card:nth-child(12)", section: "phases", timestamp: 393.148 },
          { selector: "#demo h2", section: "demo", timestamp: 412.002 },
          { selector: ".demo-terminal", section: "demo", timestamp: 415.822 },
          { selector: ".demo-controls", section: "demo", timestamp: 420.896 },
          { selector: ".phase-progress-bar", section: "demo", timestamp: 429.348 },
          { selector: ".demo-explanation", section: "demo", timestamp: 438.137 },
          { selector: "#state h2", section: "state", timestamp: 451.499 },
          { selector: ".state-highlight-box:nth-child(1)", section: "state", timestamp: 459.487 },
          { selector: ".state-highlight-box:nth-child(2)", section: "state", timestamp: 479.235 },
          { selector: ".state-code", section: "state", timestamp: 498.229 },
          { selector: "#install h2", section: "install", timestamp: 519.94 },
          { selector: ".install-command", section: "install", timestamp: 527.231 },
          { selector: ".claude-features", section: "install", timestamp: 531.701 },
          { selector: ".install-links", section: "install", timestamp: 546.248 }
        ],
        words: []
      }
    };

    // Voice audio file mapping
    const voiceFiles = {
      male: { audio: 'audio/narration-male.mp3' },
      female: { audio: 'audio/narration-female.mp3' },
      santa: { audio: 'audio/narration-santa.mp3' }
    };

    let selectedVoice = 'santa';

    function selectVoice(element) {
      document.querySelectorAll('.voice-option').forEach(opt => opt.classList.remove('selected'));
      element.classList.add('selected');
      selectedVoice = element.dataset.voice;
    }

    async function startNarration() {
      console.log('=== startNarration called ===');
      console.log('selectedVoice:', selectedVoice);
      const voice = voiceFiles[selectedVoice];
      const timing = embeddedTimingData[selectedVoice];
      console.log('voice:', voice);
      console.log('timing:', timing);

      // Hide voice selector and show narration bar
      document.getElementById('voice-selector').classList.remove('visible');
      document.getElementById('narration-launch').classList.add('hidden');
      narrationController.show();

      if (voice && timing) {
        console.log('Calling loadVoiceWithTiming...');
        try {
          // Wait for audio to be ready before playing
          await narrationController.loadVoiceWithTiming(voice.audio, timing);
          console.log('loadVoiceWithTiming completed, auto-playing...');
          // Auto-play after loading
          narrationController.togglePlay();
        } catch (err) {
          console.error('Error in loadVoiceWithTiming:', err);
        }
      } else {
        console.error('voice or timing is falsy!', { voice, timing });
      }
    }

    // Override launch button to show voice selector
    document.getElementById('narration-launch').addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      this.classList.add('hidden');
      document.getElementById('voice-selector').classList.add('visible');
    });
  </script>
</body>
</html>
